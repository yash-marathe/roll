"use strict";(globalThis.webpackChunkdocs_roll=globalThis.webpackChunkdocs_roll||[]).push([[9693],{28453:(n,e,i)=>{i.d(e,{R:()=>t,x:()=>o});var r=i(96540);const a={},s=r.createContext(a);function t(n){const e=r.useContext(s);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:t(n.components),r.createElement(s.Provider,{value:e},n.children)}},62231:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>o,default:()=>g,frontMatter:()=>t,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"User Guides/Advanced Features/async_training","title":"ROLL Asynchronous Training User Guide","description":"The ROLL framework now supports asynchronous training for both RLVR and Agentic pipelines, significantly improving training efficiency. This document provides detailed instructions on how to use this feature.","source":"@site/docs/User Guides/Advanced Features/async_training.md","sourceDirName":"User Guides/Advanced Features","slug":"/User Guides/Advanced Features/async_training","permalink":"/ROLL/docs/User Guides/Advanced Features/async_training","draft":false,"unlisted":false,"editUrl":"https://github.com/alibaba/ROLL/tree/main/docs_roll/docs/User Guides/Advanced Features/async_training.md","tags":[],"version":"current","lastUpdatedAt":1764225914000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Agentic Asynchronous Parallel Rollout","permalink":"/ROLL/docs/User Guides/Advanced Features/async_parallel_rollout"},"next":{"title":"Checkpoint Saving and Resuming Guide","permalink":"/ROLL/docs/User Guides/Advanced Features/checkpoint_and_resume"}}');var a=i(74848),s=i(28453);const t={},o="ROLL Asynchronous Training User Guide",l={},c=[{value:"Asynchronous Training Overview",id:"asynchronous-training-overview",level:2},{value:"Enabling Asynchronous Training",id:"enabling-asynchronous-training",level:2},{value:"Configuration Parameters",id:"configuration-parameters",level:3},{value:"Configuration Examples",id:"configuration-examples",level:3},{value:"Agentic Asynchronous Training Configuration",id:"agentic-asynchronous-training-configuration",level:4},{value:"RLVR Asynchronous Training Configuration",id:"rlvr-asynchronous-training-configuration",level:4},{value:"How Asynchronous Training Works",id:"how-asynchronous-training-works",level:2},{value:"Supported Algorithms",id:"supported-algorithms",level:2},{value:"Agentic Pipeline",id:"agentic-pipeline",level:3},{value:"RLVR Pipeline",id:"rlvr-pipeline",level:3},{value:"Off-Policy Algorithms",id:"off-policy-algorithms",level:3},{value:"Usage Recommendations",id:"usage-recommendations",level:2}];function d(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.header,{children:(0,a.jsx)(e.h1,{id:"roll-asynchronous-training-user-guide",children:"ROLL Asynchronous Training User Guide"})}),"\n",(0,a.jsx)(e.p,{children:"The ROLL framework now supports asynchronous training for both RLVR and Agentic pipelines, significantly improving training efficiency. This document provides detailed instructions on how to use this feature."}),"\n",(0,a.jsx)(e.h2,{id:"asynchronous-training-overview",children:"Asynchronous Training Overview"}),"\n",(0,a.jsx)(e.p,{children:"In traditional synchronous training, the training and inference processes run serially, meaning that the next batch of inference can only start after the current batch completes and rewards are collected. In asynchronous training, however, training and inference can run in parallel. The inference process can generate multiple batches of data in advance, and the training process can use this pre-generated data for learning."}),"\n",(0,a.jsx)(e.h2,{id:"enabling-asynchronous-training",children:"Enabling Asynchronous Training"}),"\n",(0,a.jsxs)(e.p,{children:["To enable asynchronous training, set the ",(0,a.jsx)(e.code,{children:"async_generation_ratio"})," parameter in your configuration file. This parameter has consistent meaning and usage across both RLVR and Agentic pipelines."]}),"\n",(0,a.jsx)(e.h3,{id:"configuration-parameters",children:"Configuration Parameters"}),"\n",(0,a.jsxs)(e.p,{children:["The ",(0,a.jsx)(e.code,{children:"async_generation_ratio"})," parameter is defined in ",(0,a.jsx)(e.code,{children:"roll/configs/base_config.py"}),":"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-python",children:'async_generation_ratio: float = field(\n    default=0,\n    metadata={\n        "help": "The ratio of ahead generation requests in pipeline, "\n        "0 means synchronous pipeline. currently only integer is supported."\n    },\n)\n'})}),"\n",(0,a.jsx)(e.h3,{id:"configuration-examples",children:"Configuration Examples"}),"\n",(0,a.jsx)(e.h4,{id:"agentic-asynchronous-training-configuration",children:"Agentic Asynchronous Training Configuration"}),"\n",(0,a.jsxs)(e.p,{children:["Here is a complete Agentic asynchronous training configuration example (from ",(0,a.jsx)(e.code,{children:"examples/qwen2.5-0.5B-agentic/agent_val_frozen_lake_async.yaml"}),"):"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:'# Enable asynchronous training\nasync_generation_ratio: 1\n\n# Other related configurations\nrollout_batch_size: 1024\nval_batch_size: 1024\nsequence_length: 8192\n\n# Training parameters\nmax_steps: 1024\nsave_steps: 10000\nlogging_steps: 1\neval_steps: 10\n\n# PPO parameters\nppo_epochs: 1\nadv_estimator: "grpo"\nwhiten_advantages: true\n\n# Model configuration\npretrain: Qwen/Qwen2.5-0.5B-Instruct\nreward_pretrain: Qwen/Qwen2.5-0.5B-Instruct\n\n# Actor configuration\nactor_train:\n  model_args:\n    attn_implementation: fa2\n    disable_gradient_checkpointing: false\n    dtype: bf16\n  training_args:\n    learning_rate: 1.0e-6\n    weight_decay: 0\n    per_device_train_batch_size: 2\n    gradient_accumulation_steps: 128\n    warmup_steps: 10\n  strategy_args:\n    strategy_name: megatron_train\n    strategy_config:\n      tensor_model_parallel_size: 1\n      pipeline_model_parallel_size: 1\n      expert_model_parallel_size: 1\n      use_distributed_optimizer: true\n      recompute_granularity: full\n  device_mapping: list(range(0,4))\n  infer_batch_size: 2\n\nactor_infer:\n  model_args:\n    disable_gradient_checkpointing: true\n    dtype: bf16\n  generating_args:\n    max_new_tokens: 128\n    top_p: 0.99\n    top_k: 100\n    num_beams: 1\n    temperature: 0.99\n    num_return_sequences: 1\n  strategy_args:\n    strategy_name: vllm\n    strategy_config:\n      gpu_memory_utilization: 0.8\n      block_size: 16\n      load_format: auto\n  device_mapping: list(range(4,8))\n'})}),"\n",(0,a.jsx)(e.h4,{id:"rlvr-asynchronous-training-configuration",children:"RLVR Asynchronous Training Configuration"}),"\n",(0,a.jsxs)(e.p,{children:["Here is a complete RLVR asynchronous training configuration example (from ",(0,a.jsx)(e.code,{children:"examples/qwen2.5-7B-rlvr_megatron/rlvr_config_async.yaml"}),"):"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:'# Enable asynchronous training\nasync_generation_ratio: 1\n\n# Other related configurations\nrollout_batch_size: 64\nprompt_length: 2048\nresponse_length: 8192\n\n# Training parameters\nmax_steps: 1000\nsave_steps: 100\nlogging_steps: 1\n\n# RLVR specific parameters\nis_num_return_sequences_expand: true\nnum_return_sequences_in_group: 8\nppo_epochs: 1\nadv_estimator: "reinforce"\n\n# Model configuration\npretrain: /data/cpfs_0/common/models/Qwen2.5-7B\nreward_pretrain: /data/cpfs_0/common/models/Qwen2.5-7B\n\n# Actor configuration\nactor_train:\n  model_args:\n    dtype: bf16\n  training_args:\n    learning_rate: 1.0e-6\n    weight_decay: 0\n    per_device_train_batch_size: 1\n    gradient_accumulation_steps: 64\n    warmup_steps: 1\n  data_args:\n    template: qwen2_5\n    file_name:\n      - data/math_deepmath_deal.jsonl\n  strategy_args:\n    strategy_name: megatron_train\n    strategy_config:\n      tensor_model_parallel_size: 2\n      pipeline_model_parallel_size: 1\n      sequence_parallel: true\n      use_distributed_optimizer: true\n  device_mapping: list(range(0,16))\n  infer_batch_size: 2\n\nactor_infer:\n  model_args:\n    dtype: fp16\n  generating_args:\n    max_new_tokens: ${response_length}\n    top_p: 0.99\n    top_k: 100\n    num_beams: 1\n    temperature: 0.99\n    num_return_sequences: ${num_return_sequences_in_group}\n  strategy_args:\n    strategy_name: sglang\n    strategy_config:\n      mem_fraction_static: 0.85\n      load_format: dummy\n  device_mapping: list(range(16,24))\n  infer_batch_size: 1\n'})}),"\n",(0,a.jsx)(e.h2,{id:"how-asynchronous-training-works",children:"How Asynchronous Training Works"}),"\n",(0,a.jsxs)(e.ol,{children:["\n",(0,a.jsxs)(e.li,{children:["When ",(0,a.jsx)(e.code,{children:"async_generation_ratio"})," is set to a value greater than 0, the framework starts asynchronous training mode"]}),"\n",(0,a.jsxs)(e.li,{children:["The inference process generates ",(0,a.jsx)(e.code,{children:"async_generation_ratio"})," times more data than needed for training in advance"]}),"\n",(0,a.jsx)(e.li,{children:"The training process can use this pre-generated data for learning without waiting for the current batch of inference to complete"}),"\n",(0,a.jsx)(e.li,{children:"This parallel processing can significantly improve training efficiency, especially when inference is time-consuming"}),"\n"]}),"\n",(0,a.jsx)(e.h2,{id:"supported-algorithms",children:"Supported Algorithms"}),"\n",(0,a.jsx)(e.h3,{id:"agentic-pipeline",children:"Agentic Pipeline"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"Supports GRPO and other policy gradient algorithms"}),"\n",(0,a.jsx)(e.li,{children:"Suitable for environment interaction tasks, such as games, dialogues, etc."}),"\n",(0,a.jsxs)(e.li,{children:["Configuration example: ",(0,a.jsx)(e.code,{children:"examples/qwen2.5-0.5B-agentic/agent_val_frozen_lake_async.yaml"})]}),"\n"]}),"\n",(0,a.jsx)(e.h3,{id:"rlvr-pipeline",children:"RLVR Pipeline"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"Supports Reinforce and other algorithms"}),"\n",(0,a.jsx)(e.li,{children:"Suitable for language modeling tasks, such as mathematical reasoning, code generation, etc."}),"\n",(0,a.jsxs)(e.li,{children:["Configuration example: ",(0,a.jsx)(e.code,{children:"examples/qwen2.5-7B-rlvr_megatron/rlvr_config_async.yaml"})]}),"\n"]}),"\n",(0,a.jsx)(e.h3,{id:"off-policy-algorithms",children:"Off-Policy Algorithms"}),"\n",(0,a.jsxs)(e.p,{children:["ROLL also supports various Off-Policy algorithms. For detailed information, please refer to: ",(0,a.jsx)(e.code,{children:"docs_roll/docs/UserGuide/algorithms/offpolicy_setting.md"})]}),"\n",(0,a.jsxs)(e.p,{children:["Configuration example: ",(0,a.jsx)(e.code,{children:"examples/qwen2.5-7B-rlvr-offpolicy/rlvr_config.yaml"})]}),"\n",(0,a.jsx)(e.p,{children:"Supported algorithm variants include:"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.code,{children:"topr"})}),"\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.code,{children:"vanilla"})}),"\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.code,{children:"tis"})}),"\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.code,{children:"cispo"})}),"\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.code,{children:"kimi15"})}),"\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.code,{children:"ppo"})}),"\n"]}),"\n",(0,a.jsx)(e.h2,{id:"usage-recommendations",children:"Usage Recommendations"}),"\n",(0,a.jsxs)(e.ol,{children:["\n",(0,a.jsxs)(e.li,{children:["Adjust the value of ",(0,a.jsx)(e.code,{children:"async_generation_ratio"})," according to hardware resources and task characteristics"]}),"\n",(0,a.jsx)(e.li,{children:"Ensure separate deployment of training and inference roles"}),"\n",(0,a.jsx)(e.li,{children:"Monitor resource usage during training to avoid resource bottlenecks"}),"\n",(0,a.jsx)(e.li,{children:"Asynchronous generation is paused during validation and resumes after validation is complete"}),"\n",(0,a.jsxs)(e.li,{children:["For RLVR tasks, you can further optimize performance by combining ",(0,a.jsx)(e.code,{children:"is_num_return_sequences_expand"})," and ",(0,a.jsx)(e.code,{children:"num_return_sequences_in_group"})," parameters"]}),"\n",(0,a.jsxs)(e.li,{children:["For Off-Policy algorithms, ensure correct configuration of the ",(0,a.jsx)(e.code,{children:"pg_variant"})," parameter and corresponding worker class"]}),"\n"]})]})}function g(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(d,{...n})}):d(n)}}}]);