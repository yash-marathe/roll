"use strict";(globalThis.webpackChunkdocs_roll=globalThis.webpackChunkdocs_roll||[]).push([[4048],{11532:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"User Guides/Hardware Support/ascend_usage","title":"ROLL x Ascend","description":"Last updated: 09/28/2025.","source":"@site/docs/User Guides/Hardware Support/ascend_usage.md","sourceDirName":"User Guides/Hardware Support","slug":"/User Guides/Hardware Support/ascend_usage","permalink":"/ROLL/docs/User Guides/Hardware Support/ascend_usage","draft":false,"unlisted":false,"editUrl":"https://github.com/alibaba/ROLL/tree/main/docs_roll/docs/User Guides/Hardware Support/ascend_usage.md","tags":[],"version":"current","lastUpdatedAt":1764225914000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Trackers and Metrics","permalink":"/ROLL/docs/User Guides/Tracker & Metrics/trackers_and_metrics"},"next":{"title":"AgenticPipeline","permalink":"/ROLL/docs/Development/Architecture/AgenticPipeline"}}');var i=r(74848),l=r(28453);const s={},d="ROLL x Ascend",c={},a=[{value:"Hardware Support",id:"hardware-support",level:2},{value:"Installation",id:"installation",level:2},{value:"Basic Environment Setup",id:"basic-environment-setup",level:3},{value:"Create Conda Environment",id:"create-conda-environment",level:3},{value:"Install torch &amp; torch_npu",id:"install-torch--torch_npu",level:3},{value:"Install vllm &amp; vllm-ascend",id:"install-vllm--vllm-ascend",level:3},{value:"Install ROLL",id:"install-roll",level:3},{value:"Additional Third-Party Libraries",id:"additional-third-party-libraries",level:3},{value:"Quick Start: Single-Node Deployment",id:"quick-start-single-node-deployment",level:2},{value:"Current Support Status",id:"current-support-status",level:2},{value:"Disclaimer",id:"disclaimer",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"roll-x-ascend",children:"ROLL x Ascend"})}),"\n",(0,i.jsx)(n.p,{children:"Last updated: 09/28/2025."}),"\n",(0,i.jsx)(n.p,{children:"We have added support for Huawei Ascend devices in ROLL."}),"\n",(0,i.jsx)(n.h2,{id:"hardware-support",children:"Hardware Support"}),"\n",(0,i.jsx)(n.p,{children:"Atlas 900 A2 PODc"}),"\n",(0,i.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,i.jsx)(n.h3,{id:"basic-environment-setup",children:"Basic Environment Setup"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Software"}),(0,i.jsx)(n.th,{children:"Version"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Python"}),(0,i.jsx)(n.td,{children:"3.10"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"CANN"}),(0,i.jsx)(n.td,{children:"8.1.RC1"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"create-conda-environment",children:"Create Conda Environment"}),"\n",(0,i.jsx)(n.p,{children:"Use the following commands to create a new conda environment in Miniconda:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"conda create --name roll python=3.10\nconda activate roll\n"})}),"\n",(0,i.jsx)(n.h3,{id:"install-torch--torch_npu",children:"Install torch & torch_npu"}),"\n",(0,i.jsx)(n.p,{children:"To use torch and torch_npu in ROLL, install them using the commands below:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# Install CPU version of torch\npip install torch==2.5.1 torchvision==0.20.1 torchaudio==2.5.1 --index-url https://download.pytorch.org/whl/cpu\n\n# Install torch_npu\npip install torch_npu==2.5.1\n"})}),"\n",(0,i.jsx)(n.h3,{id:"install-vllm--vllm-ascend",children:"Install vllm & vllm-ascend"}),"\n",(0,i.jsx)(n.p,{children:"To use vllm in ROLL, compile and install vllm and vllm-ascend as follows:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# vllm\ngit clone -b v0.8.4 --depth 1 https://github.com/vllm-project/vllm.git\ncd vllm\n\nVLLM_TARGET_DEVICE=empty pip install -v -e .\ncd ..\n# vllm-ascend\ngit clone -b v0.8.4rc2 --depth 1 https://github.com/vllm-project/vllm-ascend.git\ncd vllm-ascend\n\nexport COMPILE_CUSTOM_KERNELS=1\npip install -e .\ncd ..\n"})}),"\n",(0,i.jsx)(n.p,{children:"If you encounter an error like this during the vllm-ascend installation:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"RuntimeError: CMake configuration failed: Command '['/pathto/miniconda3/envs/roll/bin/python3.10', '-m', 'pybind11', '--cmake']' returned non-zero exit status 2.\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Try modifying lines 151\u2013158 in ",(0,i.jsx)(n.code,{children:"setup.py"})," under the vllm-ascend directory as follows, then recompile:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'try:\n    # if pybind11 is installed via pip\n    pybind11_cmake_path = (subprocess.check_output(\n        [python_executable, "-m", "pybind11",\n        "--cmakedir"]).decode().strip())\nexcept subprocess.CalledProcessError as e:\n    # else specify pybind11 path installed from source code on CI container\n    raise RuntimeError(f"CMake configuration failed: {e}")\n'})}),"\n",(0,i.jsx)(n.h3,{id:"install-roll",children:"Install ROLL"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git clone https://github.com/alibaba/ROLL.git\ncd ROLL\npip install -r requirements_common.txt\npip install deepspeed==0.16.0\ncd ..\n"})}),"\n",(0,i.jsx)(n.h3,{id:"additional-third-party-libraries",children:"Additional Third-Party Libraries"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Software"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"transformers"}),(0,i.jsx)(n.td,{children:"v4.52.4"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"flash_attn"}),(0,i.jsx)(n.td,{children:"not supported"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"transformer-engine[pytorch]"}),(0,i.jsx)(n.td,{children:"not supported"})]})]})]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"transformers"})," v4.52.4 supports enabling ",(0,i.jsx)(n.code,{children:"--flash_attention_2"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"flash_attn"})," acceleration is not supported."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"transformer-engine[pytorch]"})," is currently not supported."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"pip install transformers==4.52.4\n"})}),"\n",(0,i.jsx)(n.h2,{id:"quick-start-single-node-deployment",children:"Quick Start: Single-Node Deployment"}),"\n",(0,i.jsxs)(n.p,{children:["Before full usage, we recommend testing the single-node pipeline to verify your environment and installation.\nSince Megatron-LM training is not yet supported, first change ",(0,i.jsx)(n.code,{children:"strategy_args"})," in the relevant files to use the ",(0,i.jsx)(n.code,{children:"deepspeed"})," option."]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Run the single-node pipeline via shell:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"bash examples/agentic_demo/run_agentic_pipeline_frozen_lake_single_node_demo.sh  \n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Run the agentic pipeline using a config file:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# Make sure you are in the root directory of the ROLL project\n# export PYTHONPATH=$(pwd):$PYTHONPATH\n\npython examples/start_agentic_pipeline.py \\\n        --config_path qwen2.5-0.5B-agentic \\\n        --config_name agentic_val_sokoban\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--config_path"})," \u2013 Directory containing your YAML configuration files."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--config_name"})," \u2013 Filename (without the ",(0,i.jsx)(n.code,{children:".yaml"})," extension)."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"current-support-status",children:"Current Support Status"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Feature"}),(0,i.jsx)(n.th,{children:"Example"}),(0,i.jsx)(n.th,{children:"Training Backend"}),(0,i.jsx)(n.th,{children:"Inference Backend"}),(0,i.jsx)(n.th,{children:"Hardware"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Agentic"}),(0,i.jsx)(n.td,{children:"examples/qwen2.5-0.5B-agentic/run_agentic_pipeline_sokoban.sh"}),(0,i.jsx)(n.td,{children:"DeepSpeed"}),(0,i.jsx)(n.td,{children:"vLLM"}),(0,i.jsx)(n.td,{children:"Atlas 900 A2 PODc"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Agentic-Rollout"}),(0,i.jsx)(n.td,{children:"examples/qwen2.5-0.5B-agentic/run_agentic_rollout_sokoban.sh"}),(0,i.jsx)(n.td,{children:"DeepSpeed"}),(0,i.jsx)(n.td,{children:"vLLM"}),(0,i.jsx)(n.td,{children:"Atlas 900 A2 PODc"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"DPO"}),(0,i.jsx)(n.td,{children:"examples/qwen2.5-3B-dpo_megatron/run_dpo_pipeline.sh"}),(0,i.jsx)(n.td,{children:"DeepSpeed"}),(0,i.jsx)(n.td,{children:"vLLM"}),(0,i.jsx)(n.td,{children:"Atlas 900 A2 PODc"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"RLVR"}),(0,i.jsx)(n.td,{children:"examples/qwen2.5-7B-rlvr_megatron/run_rlvr_pipeline.sh"}),(0,i.jsx)(n.td,{children:"DeepSpeed"}),(0,i.jsx)(n.td,{children:"vLLM"}),(0,i.jsx)(n.td,{children:"Atlas 900 A2 PODc"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"disclaimer",children:"Disclaimer"}),"\n",(0,i.jsx)(n.p,{children:"The Ascend support provided in ROLL is intended as a reference example. For production use, please consult official channels."})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>d});var t=r(96540);const i={},l=t.createContext(i);function s(e){const n=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);