"use strict";(globalThis.webpackChunkdocs_roll=globalThis.webpackChunkdocs_roll||[]).push([[2932],{91810(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"User Guides/Pipeline/sft_pipeline_start","title":"SFT Pipeline","description":"Table of Contents","source":"@site/docs/User Guides/Pipeline/sft_pipeline_start.md","sourceDirName":"User Guides/Pipeline","slug":"/User Guides/Pipeline/sft_pipeline_start","permalink":"/ROLL/docs/User Guides/Pipeline/sft_pipeline_start","draft":false,"unlisted":false,"editUrl":"https://github.com/alibaba/ROLL/tree/main/docs_roll/docs/User Guides/Pipeline/sft_pipeline_start.md","tags":[],"version":"current","lastUpdatedAt":1770642330000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"RLVR Pipeline","permalink":"/ROLL/docs/User Guides/Pipeline/rlvr_pipeline_start"},"next":{"title":"RLVR Pipeline for VLM","permalink":"/ROLL/docs/User Guides/Pipeline/vl_rlvr_pipeline_start"}}');var r=i(74848),l=i(28453);const t={},d="SFT Pipeline",c={},a=[{value:"\u2728\ufe0f Overview",id:"\ufe0f-overview",level:2},{value:"\u2728\ufe0f Core Components",id:"\ufe0f-core-components",level:2},{value:"Main Module (<code>SFTPipeline</code>)",id:"main-module-sftpipeline",level:3},{value:"Worker (<code>SFTWorker</code>)",id:"worker-sftworker",level:3},{value:"Configuration (<code>SFTConfig</code>)",id:"configuration-sftconfig",level:3},{value:"Config Structure and Organization",id:"config-structure-and-organization",level:4},{value:"\u2728\ufe0f Data Preparation",id:"\ufe0f-data-preparation",level:2},{value:"Data Format",id:"data-format",level:3},{value:"Required Fields and Field Mapping",id:"required-fields-and-field-mapping",level:4},{value:"Chat Template and Labels Rules",id:"chat-template-and-labels-rules",level:4},{value:"Validation Set (<code>validation</code>)",id:"validation-set-validation",level:3},{value:"\u2728\ufe0f Running the Pipeline",id:"\ufe0f-running-the-pipeline",level:2},{value:"Method 1: Start with a Python Script",id:"method-1-start-with-a-python-script",level:3},{value:"Method 2: Use a Helper Shell Script",id:"method-2-use-a-helper-shell-script",level:3},{value:"\u2728\ufe0f Step-by-step Example",id:"\ufe0f-step-by-step-example",level:2},{value:"Step 1: Configuration",id:"step-1-configuration",level:3},{value:"Step 2: Prepare Environment and Dependencies",id:"step-2-prepare-environment-and-dependencies",level:3},{value:"Step 3: Launch the Pipeline",id:"step-3-launch-the-pipeline",level:3},{value:"Step 4: Monitoring",id:"step-4-monitoring",level:3},{value:"Step 5: Outputs and Results",id:"step-5-outputs-and-results",level:3}];function o(e){const n={a:"a",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"sft-pipeline",children:"SFT Pipeline"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Table of Contents"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#sft-pipeline",children:"SFT Pipeline"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#%EF%B8%8F-overview",children:"\u2728\ufe0f Overview"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#%EF%B8%8F-core-components",children:"\u2728\ufe0f Core Components"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsxs)(n.a,{href:"#main-module-sftpipeline",children:["Main Module (",(0,r.jsx)(n.code,{children:"SFTPipeline"}),")"]})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsxs)(n.a,{href:"#worker-sftworker",children:["Worker (",(0,r.jsx)(n.code,{children:"SFTWorker"}),")"]})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.a,{href:"#configuration-sftconfig",children:["Configuration (",(0,r.jsx)(n.code,{children:"SFTConfig"}),")"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#config-structure-and-organization",children:"Config Structure and Organization"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#%EF%B8%8F-data-preparation",children:"\u2728\ufe0f Data Preparation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#data-format",children:"Data Format"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#required-fields-and-field-mapping",children:"Required Fields and Field Mapping"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#chat-template-and-labels-rules",children:"Chat Template and Labels Rules"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsxs)(n.a,{href:"#validation-set-validation",children:["Validation Set (",(0,r.jsx)(n.code,{children:"validation"}),")"]})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#%EF%B8%8F-running-the-pipeline",children:"\u2728\ufe0f Running the Pipeline"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#method-1-start-with-a-python-script",children:"Method 1: Start with a Python Script"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#method-2-use-a-helper-shell-script",children:"Method 2: Use a Helper Shell Script"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#%EF%B8%8F-step-by-step-example",children:"\u2728\ufe0f Step-by-step Example"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#step-1-configuration",children:"Step 1: Configuration"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#step-2-prepare-environment-and-dependencies",children:"Step 2: Prepare Environment and Dependencies"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#step-3-launch-the-pipeline",children:"Step 3: Launch the Pipeline"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#step-4-monitoring",children:"Step 4: Monitoring"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#step-5-outputs-and-results",children:"Step 5: Outputs and Results"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\ufe0f-overview",children:"\u2728\ufe0f Overview"}),"\n",(0,r.jsx)(n.p,{children:"This pipeline is designed for Supervised Fine-Tuning (SFT) and provides:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Unified data encoding and chat templates"}),": Supports concatenating system/user/assistant chat formats and automatically constructs ",(0,r.jsx)(n.code,{children:"labels"})," (loss is computed only on the answer portion)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Efficient distributed training"}),": Uses ",(0,r.jsx)(n.a,{href:"https://www.ray.io/",children:"Ray"})," plus a Cluster/Worker abstraction to launch distributed training."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Comprehensive performance monitoring"}),": A fine-grained metrics tracking system that monitors performance indicators and provides full visualization and analysis of the training process."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Efficient Training Optimization"}),": Supports ",(0,r.jsx)(n.strong,{children:"Sequence Packing"})," (concatenating multiple short samples into a continuous sequence to reduce padding). For configuration methods and implementation details, please refer to the dedicated documentation for ",(0,r.jsx)(n.code,{children:"sequence packing"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\ufe0f-core-components",children:"\u2728\ufe0f Core Components"}),"\n",(0,r.jsxs)(n.h3,{id:"main-module-sftpipeline",children:["Main Module (",(0,r.jsx)(n.code,{children:"SFTPipeline"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"SFTPipeline"})," (located at ",(0,r.jsx)(n.code,{children:"roll/pipeline/sft/sft_pipeline.py"}),") is the main SFT training flow and is responsible for:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Loading the tokenizer."}),"\n",(0,r.jsx)(n.li,{children:"Loading the training dataset and the (optional) validation dataset."}),"\n",(0,r.jsxs)(n.li,{children:["Encoding data with templates to generate ",(0,r.jsx)(n.code,{children:"input_ids"})," / ",(0,r.jsx)(n.code,{children:"attention_mask"})," / ",(0,r.jsx)(n.code,{children:"labels"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Initializing the distributed training cluster (",(0,r.jsx)(n.code,{children:"Cluster"})," + ",(0,r.jsx)(n.code,{children:"SFTWorker"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Training loop: trains by step, evaluates every ",(0,r.jsx)(n.code,{children:"eval_steps"}),", saves checkpoints according to the save policy, records metrics, and reports them to the tracker."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h3,{id:"worker-sftworker",children:["Worker (",(0,r.jsx)(n.code,{children:"SFTWorker"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"SFTWorker"})," (located at ",(0,r.jsx)(n.code,{children:"roll/pipeline/sft/sft_worker.py"}),") executes training, evaluation, and checkpoint saving:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"initialize()"}),": Creates and initializes the distributed strategy (",(0,r.jsx)(n.code,{children:"create_strategy"}),") and loads the model."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"train_step()"}),": Runs one training step and returns training metrics."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"val_step()"}),": Runs one validation step (forward + loss) and returns validation metrics."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"do_checkpoint()"}),": Saves a checkpoint and returns metrics such as save time."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h3,{id:"configuration-sftconfig",children:["Configuration (",(0,r.jsx)(n.code,{children:"SFTConfig"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"SFTConfig"})," (defined in ",(0,r.jsx)(n.code,{children:"roll/pipeline/sft/sft_config.py"}),") is the configuration object (dataclass-style) for the SFT pipeline, and supports YAML + Hydra management."]}),"\n",(0,r.jsx)(n.h4,{id:"config-structure-and-organization",children:"Config Structure and Organization"}),"\n",(0,r.jsxs)(n.p,{children:["Example config file: ",(0,r.jsx)(n.code,{children:"examples/qwen2.5-7B-sft_megatron/sft_config.yaml"})]}),"\n",(0,r.jsx)(n.p,{children:"A typical config includes:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Experiment basics"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"exp_name"}),": experiment name"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"seed"}),": random seed"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"logging_dir"}),": log directory"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"output_dir"}),": checkpoint/output directory"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Training control parameters"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"save_steps"}),": checkpoint saving frequency"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"logging_steps"}),": training metrics logging frequency"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"eval_steps"}),": evaluation frequency (effective when a validation set is enabled)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"resume_from_checkpoint"}),": settings for resuming from a checkpoint"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Model configuration"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"pretrain"}),": path to the pretrained model"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Data field mapping (critical)"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"system_key"}),": system prompt field (optional)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"prompt_key"}),": prompt field name (default: ",(0,r.jsx)(n.code,{children:"instruction"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"query_key"}),": query field name (optional)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"response_key"}),": response field name (default: ",(0,r.jsx)(n.code,{children:"output"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"global_template"}),": global template name (optional; otherwise use ",(0,r.jsx)(n.code,{children:"sft_train.data_args.template"}),")"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsxs)(n.strong,{children:["Worker configuration (",(0,r.jsx)(n.code,{children:"sft_train"}),")"]}),(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.code,{children:"sft_train"})," is a ",(0,r.jsx)(n.code,{children:"WorkerConfig"})," and includes:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Data args"})," (",(0,r.jsx)(n.code,{children:"data_args"}),")","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"file_name"}),": training data JSON path (string or list)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"template"}),": template name (used when ",(0,r.jsx)(n.code,{children:"global_template"})," is not set)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"preprocessing_num_workers"}),": number of preprocessing workers"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Training args"})," (",(0,r.jsx)(n.code,{children:"training_args"}),")","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"num_train_epochs"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"learning_rate"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"per_device_train_batch_size"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"gradient_accumulation_steps"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"dataloader_num_workers"})}),"\n",(0,r.jsx)(n.li,{children:"..."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Strategy args"})," (",(0,r.jsx)(n.code,{children:"strategy_args"}),")","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"strategy_name"}),": e.g., ",(0,r.jsx)(n.code,{children:"megatron_train"})," / ",(0,r.jsx)(n.code,{children:"deepspeed_train"}),", etc."]}),"\n",(0,r.jsx)(n.li,{children:"Parallelism-related parameters (tensor/pipeline parallel sizes, etc.)"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Device mapping"})," (",(0,r.jsx)(n.code,{children:"device_mapping"}),")","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Specifies which GPUs the worker uses"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Inference batch"})," (used in validation)","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"infer_batch_size"}),": used during validation"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Validation configuration (optional)"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"validation.data_args.file_name"}),": validation data JSON path (validation is enabled only if set)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\ufe0f-data-preparation",children:"\u2728\ufe0f Data Preparation"}),"\n",(0,r.jsx)(n.h3,{id:"data-format",children:"Data Format"}),"\n",(0,r.jsxs)(n.p,{children:["The SFT pipeline uses ",(0,r.jsx)(n.strong,{children:"JSON"})," files loaded via HuggingFace Datasets."]}),"\n",(0,r.jsx)(n.h4,{id:"required-fields-and-field-mapping",children:"Required Fields and Field Mapping"}),"\n",(0,r.jsx)(n.p,{children:"Each sample must be mappable to at least:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Prompt: specified by ",(0,r.jsx)(n.code,{children:"prompt_key"})," (default: ",(0,r.jsx)(n.code,{children:"instruction"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Response: specified by ",(0,r.jsx)(n.code,{children:"response_key"})," (default: ",(0,r.jsx)(n.code,{children:"output"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Optional fields:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"system_key"}),": system prompt (optional)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"query_key"}),": additional input (optional; appended to the user content)"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"chat-template-and-labels-rules",children:"Chat Template and Labels Rules"}),"\n",(0,r.jsx)(n.p,{children:"Chat structure:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"system (optional)"}),"\n",(0,r.jsx)(n.li,{children:"user (prompt + query)"}),"\n",(0,r.jsx)(n.li,{children:"assistant (response)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Labels construction:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["All tokens in the prompt portion are set to ",(0,r.jsx)(n.code,{children:"IGNORE_INDEX"})," (not included in loss)."]}),"\n",(0,r.jsx)(n.li,{children:"Tokens in the response portion use real token ids (included in loss)."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"In other words: supervision is applied only to the model\u2019s \u201canswer portion\u201d."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h3,{id:"validation-set-validation",children:["Validation Set (",(0,r.jsx)(n.code,{children:"validation"}),")"]}),"\n",(0,r.jsx)(n.p,{children:"The validation set is optional:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["It is loaded only if ",(0,r.jsx)(n.code,{children:"validation.data_args.file_name"})," is configured."]}),"\n",(0,r.jsxs)(n.li,{children:["During training, validation is triggered according to ",(0,r.jsx)(n.code,{children:"eval_steps"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Validation is executed by ",(0,r.jsx)(n.code,{children:"sft_train.val_step"})," (no separate validation worker is launched)."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\ufe0f-running-the-pipeline",children:"\u2728\ufe0f Running the Pipeline"}),"\n",(0,r.jsx)(n.h3,{id:"method-1-start-with-a-python-script",children:"Method 1: Start with a Python Script"}),"\n",(0,r.jsxs)(n.p,{children:["Start with ",(0,r.jsx)(n.code,{children:"examples/start_sft_pipeline.py"}),"; Hydra loads the configuration:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Make sure you are in the ROLL project root directory\n# export PYTHONPATH=$(pwd):$PYTHONPATH\n\npython examples/start_sft_pipeline.py \\\n       --config_path examples/qwen2.5-7B-sft_megatron \\\n       --config_name sft_config\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--config_path"})," \u2013 config directory: ",(0,r.jsx)(n.code,{children:"examples/qwen2.5-7B-sft_megatron"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--config_name"})," \u2013 config file name: ",(0,r.jsx)(n.code,{children:"sft_config"})," (corresponds to ",(0,r.jsx)(n.code,{children:"sft_config.yaml"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"method-2-use-a-helper-shell-script",children:"Method 2: Use a Helper Shell Script"}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Example: examples/qwen2.5-7B-sft_megatron/run_sft_pipeline.sh\n\nCONFIG_NAME="sft_config"\nCONFIG_PATH="examples/qwen2.5-7B-sft_megatron"\n\npython examples/start_sft_pipeline.py \\\n       --config_path $CONFIG_PATH \\\n       --config_name $CONFIG_NAME \\\n       "$@"\n'})}),"\n",(0,r.jsx)(n.p,{children:"Run:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"bash examples/qwen2.5-7B-sft_megatron/run_sft_pipeline.sh\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\ufe0f-step-by-step-example",children:"\u2728\ufe0f Step-by-step Example"}),"\n",(0,r.jsx)(n.h3,{id:"step-1-configuration",children:"Step 1: Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["Config file: ",(0,r.jsx)(n.code,{children:"examples/qwen2.5-7B-sft_megatron/sft_config.yaml"})]}),"\n",(0,r.jsx)(n.p,{children:"Key items to check:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Data config"}),": ",(0,r.jsx)(n.code,{children:"sft_train.data_args.file_name"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Field mapping"}),": ",(0,r.jsx)(n.code,{children:"prompt_key/query_key/response_key/system_key"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Model config"}),": ",(0,r.jsx)(n.code,{children:"pretrain"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Distributed strategy"}),": ",(0,r.jsx)(n.code,{children:"sft_train.strategy_args"})," and ",(0,r.jsx)(n.code,{children:"sft_train.device_mapping"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Validation config (optional)"}),": ",(0,r.jsx)(n.code,{children:"validation.data_args.file_name"})," and ",(0,r.jsx)(n.code,{children:"eval_steps"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Template selection"}),": ",(0,r.jsx)(n.code,{children:"global_template"})," or ",(0,r.jsx)(n.code,{children:"sft_train.data_args.template"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"step-2-prepare-environment-and-dependencies",children:"Step 2: Prepare Environment and Dependencies"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pip install -r requirements.txt\n"})}),"\n",(0,r.jsx)(n.p,{children:"Also ensure:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"pretrain"})," path is accessible"]}),"\n",(0,r.jsxs)(n.li,{children:["The fields in training/validation JSON match ",(0,r.jsx)(n.code,{children:"prompt_key/response_key/..."})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"step-3-launch-the-pipeline",children:"Step 3: Launch the Pipeline"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"python examples/start_sft_pipeline.py \\\n       --config_path examples/qwen2.5-7B-sft_megatron \\\n       --config_name sft_config\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-4-monitoring",children:"Step 4: Monitoring"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Console output"})," \u2013 watch Hydra, Ray, and pipeline logs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Log files"})," \u2013 check ",(0,r.jsx)(n.code,{children:"logging_dir"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"TensorBoard"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"tensorboard --logdir <your_log_dir>\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"step-5-outputs-and-results",children:"Step 5: Outputs and Results"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Trained model"})," \u2013 checkpoints are saved under ",(0,r.jsx)(n.code,{children:"output_dir"})," with the default structure:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"<output_dir>/sft_train/checkpoint-<global_step>/<cluster_name>/\n"})}),"\n",(0,r.jsx)(n.p,{children:"Where:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<global_step>"}),": current training step (e.g., ",(0,r.jsx)(n.code,{children:"checkpoint-200"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<cluster_name>"}),": distributed cluster name (determined by Cluster/Ray runtime)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Training/validation metrics"})," \u2013 recorded in the terminal and tracker/TensorBoard (depending on tracker configuration)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Happy experimenting!"})})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},28453(e,n,i){i.d(n,{R:()=>t,x:()=>d});var s=i(96540);const r={},l=s.createContext(r);function t(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);