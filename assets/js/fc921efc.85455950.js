"use strict";(globalThis.webpackChunkdocs_roll=globalThis.webpackChunkdocs_roll||[]).push([[6916],{28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>c});var s=i(96540);const t={},r=s.createContext(t);function a(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(r.Provider,{value:n},e.children)}},44526:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"User Guides/Advanced Features/checkpoint_and_resume","title":"Checkpoint Saving and Resuming Guide","description":"In the ROLL framework, the checkpoint mechanism allows you to save the model state during training so that you can resume training when needed. This document will provide detailed instructions on how to configure and use the checkpoint saving and resuming functionality.","source":"@site/docs/User Guides/Advanced Features/checkpoint_and_resume.md","sourceDirName":"User Guides/Advanced Features","slug":"/User Guides/Advanced Features/checkpoint_and_resume","permalink":"/ROLL/docs/User Guides/Advanced Features/checkpoint_and_resume","draft":false,"unlisted":false,"editUrl":"https://github.com/alibaba/ROLL/tree/main/docs_roll/docs/User Guides/Advanced Features/checkpoint_and_resume.md","tags":[],"version":"current","lastUpdatedAt":1764581625000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"ROLL Asynchronous Training User Guide","permalink":"/ROLL/docs/User Guides/Advanced Features/async_training"},"next":{"title":"Converting MCoreAdapter Models to Hugging Face Format","permalink":"/ROLL/docs/User Guides/Advanced Features/megatron_convert_2_hf"}}');var t=i(74848),r=i(28453);const a={},c="Checkpoint Saving and Resuming Guide",o={},l=[{value:"Checkpoint Saving Configuration",id:"checkpoint-saving-configuration",level:2},{value:"Configuration Parameter Details",id:"configuration-parameter-details",level:3},{value:"Checkpoint Saving Mechanism",id:"checkpoint-saving-mechanism",level:2},{value:"Resuming Training Configuration",id:"resuming-training-configuration",level:2},{value:"How Resuming Training Works",id:"how-resuming-training-works",level:3},{value:"Usage Example",id:"usage-example",level:2},{value:"Best Practices",id:"best-practices",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"checkpoint-saving-and-resuming-guide",children:"Checkpoint Saving and Resuming Guide"})}),"\n",(0,t.jsx)(n.p,{children:"In the ROLL framework, the checkpoint mechanism allows you to save the model state during training so that you can resume training when needed. This document will provide detailed instructions on how to configure and use the checkpoint saving and resuming functionality."}),"\n",(0,t.jsx)(n.h2,{id:"checkpoint-saving-configuration",children:"Checkpoint Saving Configuration"}),"\n",(0,t.jsxs)(n.p,{children:["The ROLL framework configures checkpoint saving settings through the ",(0,t.jsx)(n.code,{children:"checkpoint_config"})," parameter. The following is a typical configuration example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"checkpoint_config:\n  type: file_system\n  output_dir: /data/cpfs_0/rl_examples/models/${exp_name}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"configuration-parameter-details",children:"Configuration Parameter Details"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"type"}),": Specifies the type of checkpoint storage"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Currently supports ",(0,t.jsx)(n.code,{children:"file_system"}),", which means saving checkpoints to the file system"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"output_dir"}),": Specifies the directory path for saving checkpoints"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Variables can be used, such as ",(0,t.jsx)(n.code,{children:"${exp_name}"})," for the experiment name"]}),"\n",(0,t.jsx)(n.li,{children:"The framework will automatically create timestamp subdirectories under this directory to distinguish different checkpoints"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"checkpoint-saving-mechanism",children:"Checkpoint Saving Mechanism"}),"\n",(0,t.jsx)(n.p,{children:"The ROLL framework automatically saves checkpoints in the following situations:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Periodic Saving"}),": Automatically saved at intervals set by the ",(0,t.jsx)(n.code,{children:"save_steps"})," parameter"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"save_steps: 100  # Save checkpoint every 100 steps\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"At Training End"}),": Automatically save the final checkpoint when training is completed"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Manual Saving"}),": Checkpoints can be manually saved by calling the appropriate API in the code"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"resuming-training-configuration",children:"Resuming Training Configuration"}),"\n",(0,t.jsxs)(n.p,{children:["To resume training from a checkpoint, set the ",(0,t.jsx)(n.code,{children:"resume_from_checkpoint"})," parameter:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"resume_from_checkpoint: false  # Default is not to resume training\n"})}),"\n",(0,t.jsx)(n.p,{children:"To enable the resume training feature, set this parameter to the checkpoint path:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"resume_from_checkpoint: /data/cpfs_0/rl_examples/models/exp_name/checkpoint-500\n"})}),"\n",(0,t.jsx)(n.h3,{id:"how-resuming-training-works",children:"How Resuming Training Works"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["When ",(0,t.jsx)(n.code,{children:"resume_from_checkpoint"})," is set to a valid checkpoint path, the framework will:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Load model parameters"}),"\n",(0,t.jsx)(n.li,{children:"Restore optimizer state"}),"\n",(0,t.jsx)(n.li,{children:"Restore learning rate scheduler state"}),"\n",(0,t.jsx)(n.li,{children:"Restore other training states such as training steps"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Resuming training continues from the training step at which the checkpoint was saved"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"usage-example",children:"Usage Example"}),"\n",(0,t.jsx)(n.p,{children:"The following is a complete configuration example showing how to set up checkpoint saving and resuming functionality:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'exp_name: "qwen2.5-7B-rlvr-config"\nseed: 42\nlogging_dir: ./output/logs\noutput_dir: ./output\n\n# Checkpoint configuration\ncheckpoint_config:\n  type: file_system\n  output_dir: /data/cpfs_0/rl_examples/models/${exp_name}\n\n# Resume training configuration\nresume_from_checkpoint: false  # Set to checkpoint path to resume training\n\n# Training control parameters\nmax_steps: 500\nsave_steps: 100  # Save checkpoint every 100 steps\nlogging_steps: 1\neval_steps: 10\n\n# Other training configurations...\n'})}),"\n",(0,t.jsxs)(n.p,{children:["To resume training from a checkpoint, simply set ",(0,t.jsx)(n.code,{children:"resume_from_checkpoint"})," to the corresponding checkpoint path:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"resume_from_checkpoint: /data/cpfs_0/rl_examples/models/qwen2.5-7B-rlvr-config/checkpoint-300\n"})}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Periodic Checkpoint Saving"}),": Reasonably set ",(0,t.jsx)(n.code,{children:"save_steps"})," based on training time and resource consumption"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Check Storage Space"}),": Ensure ",(0,t.jsx)(n.code,{children:"output_dir"})," has sufficient storage space to save checkpoints"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Verify Checkpoints"}),": Verify the integrity and validity of checkpoints before resuming training"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Backup Important Checkpoints"}),": Backup important checkpoints to prevent data loss"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"By properly configuring the checkpoint saving and resuming functionality, you can ensure the safety and recoverability of the training process, avoiding loss of training progress due to unexpected interruptions."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);