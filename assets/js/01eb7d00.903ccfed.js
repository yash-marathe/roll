"use strict";(globalThis.webpackChunkdocs_roll=globalThis.webpackChunkdocs_roll||[]).push([[1338],{5680:(e,n,a)=>{a.d(n,{xA:()=>g,yg:()=>_});var t=a(6540);function l(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function r(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),a.push.apply(a,t)}return a}function o(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?r(Object(a),!0).forEach(function(n){l(e,n,a[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))})}return e}function i(e,n){if(null==e)return{};var a,t,l=function(e,n){if(null==e)return{};var a,t,l={},r=Object.keys(e);for(t=0;t<r.length;t++)a=r[t],n.indexOf(a)>=0||(l[a]=e[a]);return l}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(t=0;t<r.length;t++)a=r[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(l[a]=e[a])}return l}var s=t.createContext({}),p=function(e){var n=t.useContext(s),a=n;return e&&(a="function"==typeof e?e(n):o(o({},n),e)),a},g=function(e){var n=p(e.components);return t.createElement(s.Provider,{value:n},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},m=t.forwardRef(function(e,n){var a=e.components,l=e.mdxType,r=e.originalType,s=e.parentName,g=i(e,["components","mdxType","originalType","parentName"]),d=p(a),m=l,_=d["".concat(s,".").concat(m)]||d[m]||u[m]||r;return a?t.createElement(_,o(o({ref:n},g),{},{components:a})):t.createElement(_,o({ref:n},g))});function _(e,n){var a=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var r=a.length,o=new Array(r);o[0]=m;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i[d]="string"==typeof e?e:l,o[1]=i;for(var p=2;p<r;p++)o[p]=a[p];return t.createElement.apply(null,o)}return t.createElement.apply(null,a)}m.displayName="MDXCreateElement"},6793:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>p});var t=a(8168),l=(a(6540),a(5680));const r={},o="Agentic \u5de5\u7a0b\u5b9e\u8df5\u6587\u6863",i={unversionedId:"\u7b80\u4f53\u4e2d\u6587/\u4f7f\u7528\u6307\u5357/agentic/agentic_engineer_practice",id:"\u7b80\u4f53\u4e2d\u6587/\u4f7f\u7528\u6307\u5357/agentic/agentic_engineer_practice",title:"Agentic \u5de5\u7a0b\u5b9e\u8df5\u6587\u6863",description:"\u672c\u6587\u6863\u4ecb\u7ecd\u4e86 ROLL\u6846\u67b6 \u4e2d Agentic \u90e8\u5206\u7684\u5f00\u53d1\u5b9e\u8df5\u7ecf\u9a8c\uff0c\u5305\u62ec\u73af\u5883\u7ba1\u7406\u5668\u5f00\u53d1\u534f\u8bae\u3001GlobalDataset \u4f7f\u7528\u3001\u9a8c\u8bc1\u6a21\u5f0f\u914d\u7f6e\u548c\u8f68\u8ff9\u5408\u6210\u529f\u80fd\u3002",source:"@site/docs/\u7b80\u4f53\u4e2d\u6587/\u4f7f\u7528\u6307\u5357/agentic/agentic_engineer_practice.md",sourceDirName:"\u7b80\u4f53\u4e2d\u6587/\u4f7f\u7528\u6307\u5357/agentic",slug:"/\u7b80\u4f53\u4e2d\u6587/\u4f7f\u7528\u6307\u5357/agentic/agentic_engineer_practice",permalink:"/ROLL/docs/\u7b80\u4f53\u4e2d\u6587/\u4f7f\u7528\u6307\u5357/agentic/agentic_engineer_practice",draft:!1,editUrl:"https://github.com/alibaba/ROLL/tree/main/docs_roll/docs/\u7b80\u4f53\u4e2d\u6587/\u4f7f\u7528\u6307\u5357/agentic/agentic_engineer_practice.md",tags:[],version:"current",lastUpdatedAt:1761894972,formattedLastUpdatedAt:"Oct 31, 2025",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"TrajWiseLearning\u2014\u2014StarPO (State-Thinking-Actions-Reward Policy Optimization)",permalink:"/ROLL/docs/\u7b80\u4f53\u4e2d\u6587/\u4f7f\u7528\u6307\u5357/agentic/agentic_StarPO"},next:{title:"Group Relative Policy Optimization (GRPO)",permalink:"/ROLL/docs/\u7b80\u4f53\u4e2d\u6587/\u4f7f\u7528\u6307\u5357/algorithms/GRPO"}},s={},p=[{value:"1. EnvManager \u5f00\u53d1\u534f\u8bae",id:"1-envmanager-\u5f00\u53d1\u534f\u8bae",level:2},{value:"1.1 \u6838\u5fc3\u5faa\u73af\u673a\u5236",id:"11-\u6838\u5fc3\u5faa\u73af\u673a\u5236",level:3},{value:"1.2 EnvManager\u5f00\u53d1\u7ea6\u675f",id:"12-envmanager\u5f00\u53d1\u7ea6\u675f",level:3},{value:"2. GlobalDataset \u4f7f\u7528",id:"2-globaldataset-\u4f7f\u7528",level:2},{value:"2.1 \u8bbe\u8ba1\u76ee\u7684",id:"21-\u8bbe\u8ba1\u76ee\u7684",level:3},{value:"2.2 \u7c7b\u5b9a\u4e49\u548c\u4f4d\u7f6e",id:"22-\u7c7b\u5b9a\u4e49\u548c\u4f4d\u7f6e",level:3},{value:"2.3 \u4e24\u79cd\u5de5\u4f5c\u6a21\u5f0f",id:"23-\u4e24\u79cd\u5de5\u4f5c\u6a21\u5f0f",level:3},{value:"Sample Mode\uff08\u91c7\u6837\u6a21\u5f0f\uff09",id:"sample-mode\u91c7\u6837\u6a21\u5f0f",level:4},{value:"Traversal Mode\uff08\u904d\u5386\u6a21\u5f0f\uff09",id:"traversal-mode\u904d\u5386\u6a21\u5f0f",level:4},{value:"2.4 \u6838\u5fc3\u7279\u6027",id:"24-\u6838\u5fc3\u7279\u6027",level:3},{value:"2.5 \u4f7f\u7528\u793a\u4f8b",id:"25-\u4f7f\u7528\u793a\u4f8b",level:3},{value:"3. \u8bad\u7ec3\u8fc7\u7a0b\u4e2d val \u904d\u5386\u6570\u636e\u96c6\u914d\u7f6e",id:"3-\u8bad\u7ec3\u8fc7\u7a0b\u4e2d-val-\u904d\u5386\u6570\u636e\u96c6\u914d\u7f6e",level:2},{value:"3.1 \u914d\u7f6e\u539f\u5219",id:"31-\u914d\u7f6e\u539f\u5219",level:3},{value:"3.2 MathEnv \u5b9e\u73b0\u53c2\u8003",id:"32-mathenv-\u5b9e\u73b0\u53c2\u8003",level:3},{value:"3.3 YAML \u914d\u7f6e\u793a\u4f8b",id:"33-yaml-\u914d\u7f6e\u793a\u4f8b",level:3},{value:"3.4 \u968f\u673a\u91c7\u6837\u7c7b\u8bc4\u4f30\u573a\u666f",id:"34-\u968f\u673a\u91c7\u6837\u7c7b\u8bc4\u4f30\u573a\u666f",level:3},{value:"4. \u8f68\u8ff9\u5408\u6210\u904d\u5386\u6570\u636e\u96c6\u914d\u7f6e",id:"4-\u8f68\u8ff9\u5408\u6210\u904d\u5386\u6570\u636e\u96c6\u914d\u7f6e",level:2},{value:"4.1 AgenticRolloutPipeline \u5b9e\u73b0",id:"41-agenticrolloutpipeline-\u5b9e\u73b0",level:3},{value:"4.2 \u542f\u52a8\u65b9\u5f0f",id:"42-\u542f\u52a8\u65b9\u5f0f",level:3},{value:"4.3 \u6838\u5fc3\u914d\u7f6e\u53c2\u8003",id:"43-\u6838\u5fc3\u914d\u7f6e\u53c2\u8003",level:3},{value:"4.4 \u8f68\u8ff9 Dump \u914d\u7f6e",id:"44-\u8f68\u8ff9-dump-\u914d\u7f6e",level:3},{value:"4.5 \u91cd\u8981\u8bf4\u660e",id:"45-\u91cd\u8981\u8bf4\u660e",level:3},{value:"5. \u8f68\u8ff9\u8fc7\u6ee4",id:"5-\u8f68\u8ff9\u8fc7\u6ee4",level:2},{value:"5.1 \u4f7f\u7528\u65b9\u5f0f",id:"51-\u4f7f\u7528\u65b9\u5f0f",level:3},{value:"5.2 \u81ea\u5b9a\u4e49\u8fc7\u6ee4\u903b\u8f91",id:"52-\u81ea\u5b9a\u4e49\u8fc7\u6ee4\u903b\u8f91",level:3},{value:"6. \u5e38\u89c1\u95ee\u9898",id:"6-\u5e38\u89c1\u95ee\u9898",level:2},{value:"Q1: \u5982\u4f55\u5904\u7406\u6570\u636e\u96c6\u904d\u5386\u5b8c\u6210\u7684\u60c5\u51b5\uff1f",id:"q1-\u5982\u4f55\u5904\u7406\u6570\u636e\u96c6\u904d\u5386\u5b8c\u6210\u7684\u60c5\u51b5",level:3},{value:"Q2: \u5982\u4f55\u786e\u4fdd\u5b9e\u9a8c\u7684\u53ef\u91cd\u73b0\u6027\uff1f",id:"q2-\u5982\u4f55\u786e\u4fdd\u5b9e\u9a8c\u7684\u53ef\u91cd\u73b0\u6027",level:3},{value:"Q3: \u5982\u4f55\u5904\u7406\u5927\u89c4\u6a21\u8f68\u8ff9\u6570\u636e\u7684\u5b58\u50a8\uff1f",id:"q3-\u5982\u4f55\u5904\u7406\u5927\u89c4\u6a21\u8f68\u8ff9\u6570\u636e\u7684\u5b58\u50a8",level:3},{value:"Q4: \u5982\u4f55\u8c03\u8bd5\u8f68\u8ff9\u751f\u6210\u8fc7\u7a0b\uff1f",id:"q4-\u5982\u4f55\u8c03\u8bd5\u8f68\u8ff9\u751f\u6210\u8fc7\u7a0b",level:3}],g={toc:p},d="wrapper";function u({components:e,...n}){return(0,l.yg)(d,(0,t.A)({},g,n,{components:e,mdxType:"MDXLayout"}),(0,l.yg)("h1",{id:"agentic-\u5de5\u7a0b\u5b9e\u8df5\u6587\u6863"},"Agentic \u5de5\u7a0b\u5b9e\u8df5\u6587\u6863"),(0,l.yg)("p",null,"\u672c\u6587\u6863\u4ecb\u7ecd\u4e86 ROLL\u6846\u67b6 \u4e2d Agentic \u90e8\u5206\u7684\u5f00\u53d1\u5b9e\u8df5\u7ecf\u9a8c\uff0c\u5305\u62ec\u73af\u5883\u7ba1\u7406\u5668\u5f00\u53d1\u534f\u8bae\u3001GlobalDataset \u4f7f\u7528\u3001\u9a8c\u8bc1\u6a21\u5f0f\u914d\u7f6e\u548c\u8f68\u8ff9\u5408\u6210\u529f\u80fd\u3002"),(0,l.yg)("h2",{id:"1-envmanager-\u5f00\u53d1\u534f\u8bae"},"1. EnvManager \u5f00\u53d1\u534f\u8bae"),(0,l.yg)("p",null,"EnvManager \u662f Agentic \u6846\u67b6\u7684\u6838\u5fc3\u7ec4\u4ef6\uff0c\u8d1f\u8d23\u73af\u5883\u7684\u7ba1\u7406\u548c\u8f68\u8ff9\u7684\u751f\u6210\u3002\u5f00\u53d1\u65b0\u7684 EnvManager \u9700\u8981\u9075\u5faa\u4ee5\u4e0b\u534f\u8bae\uff1a"),(0,l.yg)("h3",{id:"11-\u6838\u5fc3\u5faa\u73af\u673a\u5236"},"1.1 \u6838\u5fc3\u5faa\u73af\u673a\u5236"),(0,l.yg)("p",null,"EnvManager \u5fc5\u987b\u5b9e\u73b0 ",(0,l.yg)("inlineCode",{parentName:"p"},"run_rollout_loop")," \u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u9075\u5faa\u4ee5\u4e0b\u534f\u8bae\uff1a"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-python"},'def run_rollout_loop(self, data: DataProto):\n    """\n    1. \u6bcf\u6b21\u8c03\u7528 run_rollout_loop \u65f6\uff0c\u4f1a\u6301\u7eed\u6267\u884c episode \u76f4\u5230\u6536\u5230\u6570\u636e\u6536\u96c6\u5b8c\u6210\u7684\u547d\u4ee4\n    2. \u9700\u8981\u91cd\u7f6e seed \u4ee5\u786e\u4fdd\u6240\u6709 group \u7684\u4e00\u81f4\u6027\n    3. episode_id \u4ece scheduler \u7aef\u83b7\u53d6\n\n    Seed \u66f4\u65b0\u903b\u8f91:\n       group_seed = base_seed + group_id\n       episode_seed = group_seed + episode_id\n\n    trajectory_id: f"{group_id}_{episode_id}_{episode_seed}"\n    """\n    \n    # \u6781\u7b80\u8c03\u7528\u793a\u4f8b\n    while self.running:\n        # \u4ece scheduler \u83b7\u53d6 episode_id\n        self.episode_id = ray.get(self.output_queue.get_episode_id.remote(self.env_config["group_id"]))\n        if self.episode_id is None:\n            break\n        \n        # \u91cd\u7f6e\u73af\u5883\n        rollout_cache = self.reset()\n        \n        while rollout_cache is not None and not rollout_cache.terminated and not rollout_cache.truncated:\n            # \u505a\u51fa\u51b3\u7b56\n            lm_output = self.make_decision(rollout_cache)\n            # \u6267\u884c\u73af\u5883\u6b65\u9aa4\n            rollout_cache = self.step(lm_output)\n        \n        # \u63d0\u4ea4\u8f68\u8ff9\n        rollout = self.formulate_rollouts(rollout_cache)\n        ray.get(self.output_queue.put.remote(self.env_config[\'group_id\'], self.episode_id, start_step, rollout))\n')),(0,l.yg)("h3",{id:"12-envmanager\u5f00\u53d1\u7ea6\u675f"},"1.2 EnvManager\u5f00\u53d1\u7ea6\u675f"),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("strong",{parentName:"li"},"while loop \u65e0\u9650\u5faa\u73af"),"\uff1aEnvManager \u901a\u8fc7 while \u5faa\u73af\u6301\u7eed\u6267\u884c episode"),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("strong",{parentName:"li"},"\u6570\u636e\u96c6\u904d\u5386\u5b8c\u6210\u624d\u8fd4\u56de None \u9000\u51fa"),"\uff1a\u5f53\u6570\u636e\u96c6\u904d\u5386\u5b8c\u6210\u65f6\uff0c",(0,l.yg)("inlineCode",{parentName:"li"},"reset()")," \u65b9\u6cd5\u8fd4\u56de None\uff0c\u89e6\u53d1\u5faa\u73af\u9000\u51fa"),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("strong",{parentName:"li"},"\u6bcf\u4e2a episode \u5fc5\u987b\u6709\u5bf9\u5e94\u7684\u8f68\u8ff9 put"),"\uff1a\u6bcf\u4e2a\u5b8c\u6210\u7684 episode \u5fc5\u987b\u901a\u8fc7 ",(0,l.yg)("inlineCode",{parentName:"li"},"output_queue.put")," \u63d0\u4ea4\u8f68\u8ff9\u6570\u636e")),(0,l.yg)("h2",{id:"2-globaldataset-\u4f7f\u7528"},"2. GlobalDataset \u4f7f\u7528"),(0,l.yg)("h3",{id:"21-\u8bbe\u8ba1\u76ee\u7684"},"2.1 \u8bbe\u8ba1\u76ee\u7684"),(0,l.yg)("p",null,"\u4e3a\u4e86\u907f\u514d\u6bcf\u4e2a env \u5404\u81ea\u8bfb\u53d6\u6570\u636e\u9020\u6210\u7684\u8bbf\u5b58/\u5185\u5b58\u74f6\u9888\uff0c\u6846\u67b6\u5c42\u9762\u63d0\u4f9b\u4e86 GlobalDataset \u7ec4\u4ef6\uff0c\u5b9e\u73b0\u6570\u636e\u96c6\u7684\u7edf\u4e00\u7ba1\u7406\u548c\u5206\u53d1\u3002"),(0,l.yg)("h3",{id:"22-\u7c7b\u5b9a\u4e49\u548c\u4f4d\u7f6e"},"2.2 \u7c7b\u5b9a\u4e49\u548c\u4f4d\u7f6e"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-python"},'# \u4f4d\u7f6e: roll.datasets.global_dataset.GlobalDataset\n@ray.remote\nclass GlobalDataset:\n    def __init__(self, dataset_name, split: str = "train", mode="sample", dataset_kwargs: Dict = None):\n        # mode: "sample" \u6216 "traversal"\n')),(0,l.yg)("h3",{id:"23-\u4e24\u79cd\u5de5\u4f5c\u6a21\u5f0f"},"2.3 \u4e24\u79cd\u5de5\u4f5c\u6a21\u5f0f"),(0,l.yg)("h4",{id:"sample-mode\u91c7\u6837\u6a21\u5f0f"},"Sample Mode\uff08\u91c7\u6837\u6a21\u5f0f\uff09"),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("strong",{parentName:"li"},"\u7528\u9014"),"\uff1a\u8bad\u7ec3\u6a21\u5f0f\u4e0b\u968f\u673a\u91c7\u6837\u6570\u636e\u96c6"),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("strong",{parentName:"li"},"\u7279\u70b9"),"\uff1a\u6bcf\u6b21\u968f\u673a\u9009\u62e9\u6570\u636e\u9879"),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("strong",{parentName:"li"},"\u914d\u7f6e"),"\uff1a",(0,l.yg)("inlineCode",{parentName:"li"},'mode="sample"'))),(0,l.yg)("h4",{id:"traversal-mode\u904d\u5386\u6a21\u5f0f"},"Traversal Mode\uff08\u904d\u5386\u6a21\u5f0f\uff09"),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("strong",{parentName:"li"},"\u7528\u9014"),"\uff1a\u9a8c\u8bc1\u6a21\u5f0f\u4e0b\u9700\u8981\u904d\u5386\u6574\u4e2a\u6570\u636e\u96c6"),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("strong",{parentName:"li"},"\u7279\u70b9"),"\uff1a\u6309\u987a\u5e8f\u904d\u5386\u6570\u636e\u96c6\uff0c\u786e\u4fdd\u6bcf\u4e2a\u6570\u636e\u9879\u90fd\u88ab\u8bbf\u95ee"),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("strong",{parentName:"li"},"\u914d\u7f6e"),"\uff1a",(0,l.yg)("inlineCode",{parentName:"li"},'mode="traversal"'))),(0,l.yg)("h3",{id:"24-\u6838\u5fc3\u7279\u6027"},"2.4 \u6838\u5fc3\u7279\u6027"),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("strong",{parentName:"li"},"\u786e\u5b9a\u6027\u91c7\u6837"),"\uff1a",(0,l.yg)("inlineCode",{parentName:"li"},"get_data_item")," \u65b9\u6cd5\u4fdd\u8bc1\u76f8\u540c\u7684 seed \u8fd4\u56de\u76f8\u540c\u7684\u6570\u636e"),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("strong",{parentName:"li"},"\u72b6\u6001\u7ba1\u7406"),"\uff1a\u5185\u90e8\u7ef4\u62a4\u7d22\u5f15\u72b6\u6001\uff0c\u652f\u6301\u6570\u636e\u96c6\u7684\u91cd\u7f6e\u548c\u904d\u5386")),(0,l.yg)("h3",{id:"25-\u4f7f\u7528\u793a\u4f8b"},"2.5 \u4f7f\u7528\u793a\u4f8b"),(0,l.yg)("p",null,"\u53c2\u8003 MathEnv\u3001SWEEnv\u3001TerminalBenchEnv \u7684\u5b9e\u73b0\uff1a"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-python"},'class MathEnv(GEMMathEnv):\n    def __init__(self, dataset_name: str = "", mode: str = "train", **kwargs):\n        # \u8f6c\u6362 train/val mode \u4e3a sample/traversal\n        global_dataset_mode = "sample" if self.mode == "train" else "traversal"\n        \n        self.dataset = GlobalDataset.options(\n            name=f"{self.mode}_{dataset_name}",\n            get_if_exists=True,\n            namespace=RAY_NAMESPACE\n        ).remote(\n            dataset_name=dataset_name,\n            split=split,\n            mode=global_dataset_mode\n        )\n        \n        # \u521b\u5efa\u5e76\u6ce8\u518c dataset_manager\uff0c\u8fd9\u662f\u5b9e\u73b0\u591a\u6b21val\u7684\u5fc5\u8981\u5b9e\u73b0\n        self.dataset_manager = GlobalDatasetManager.options(\n            name=f"{self.mode}_dataset_manager",\n            get_if_exists=True,\n            namespace=RAY_NAMESPACE\n        ).remote()\n        ray.get(self.dataset_manager.register.remote(\n            dataset_name=dataset_name, \n            dataset_ref=self.dataset\n        ))\n')),(0,l.yg)("h2",{id:"3-\u8bad\u7ec3\u8fc7\u7a0b\u4e2d-val-\u904d\u5386\u6570\u636e\u96c6\u914d\u7f6e"},"3. \u8bad\u7ec3\u8fc7\u7a0b\u4e2d val \u904d\u5386\u6570\u636e\u96c6\u914d\u7f6e"),(0,l.yg)("h3",{id:"31-\u914d\u7f6e\u539f\u5219"},"3.1 \u914d\u7f6e\u539f\u5219"),(0,l.yg)("p",null,"\u5bf9\u4e8e\u9700\u8981\u904d\u5386\u6570\u636e\u96c6\u7684\u573a\u666f\uff08\u5982 math/code/swe \u7b49\u9a8c\u8bc1\u573a\u666f\uff09\uff0c\u9700\u8981\u7279\u6b8a\u914d\u7f6e\uff1a"),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("strong",{parentName:"li"},"env \u5b9a\u4e49\u65f6\u8bbe\u7f6e mode \u53c2\u6570"),"\uff1aval \u6a21\u5f0f\u4e0b\u9700\u8981\u8bbe\u7f6e ",(0,l.yg)("inlineCode",{parentName:"li"},"mode=val")),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("strong",{parentName:"li"},"\u8bbe\u7f6e val_batch_size=-1"),"\uff1a\u8fd9\u6837\u53ef\u4ee5\u904d\u5386\u6574\u4e2a val dataset"),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("strong",{parentName:"li"},"env.reset \u8fd4\u56de None \u65f6\u9000\u51fa"),"\uff1a\u5f53\u6570\u636e\u96c6\u904d\u5386\u5b8c\u6210\u65f6\uff0cenv.reset \u4f1a\u8fd4\u56de None")),(0,l.yg)("h3",{id:"32-mathenv-\u5b9e\u73b0\u53c2\u8003"},"3.2 MathEnv \u5b9e\u73b0\u53c2\u8003"),(0,l.yg)("p",null,"\u4f4d\u7f6e\uff1a",(0,l.yg)("inlineCode",{parentName:"p"},"roll.pipeline.agentic.env.gem.math_env.MathEnv")),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-python"},'class MathEnv(GEMMathEnv):\n    def __init__(self, mode: str = "train", **kwargs):\n        # \u8f6c\u6362\u6a21\u5f0f\n        global_dataset_mode = "sample" if self.mode == "train" else "traversal"\n        self.dataset = GlobalDataset.remote(\n            dataset_name=dataset_name,\n            split=split,\n            mode=global_dataset_mode\n        )\n    \n    def reset(self, seed: Optional[None] = None) -> Tuple[str, dict[str, Any]]:\n        data = ray.get(self.dataset.get_data_item.remote(seed=seed))\n        if data is None:\n            return None, None  # \u6570\u636e\u96c6\u904d\u5386\u5b8c\u6210\n        # \u5904\u7406\u6570\u636e...\n')),(0,l.yg)("h3",{id:"33-yaml-\u914d\u7f6e\u793a\u4f8b"},"3.3 YAML \u914d\u7f6e\u793a\u4f8b"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-yaml"},'rollout_batch_size: 128\nval_batch_size: -1  # \u904d\u5386\u6574\u4e2a\u6570\u636e\u96c6\n\ndeep_math:\n    env_type: "roll_math"\n    env_config:\n      mode: val  # \u8bbe\u7f6e\u4e3a\u9a8c\u8bc1\u6a21\u5f0f\n      dataset_name: data/math_deepmath_deal.jsonl\n      split: train\n      question_key: prompt\n      answer_key: ground_truth\n')),(0,l.yg)("h3",{id:"34-\u968f\u673a\u91c7\u6837\u7c7b\u8bc4\u4f30\u573a\u666f"},"3.4 \u968f\u673a\u91c7\u6837\u7c7b\u8bc4\u4f30\u573a\u666f"),(0,l.yg)("p",null,"\u5bf9\u4e8e\u6e38\u620f\u7c7b\u7b49\u968f\u673a\u91c7\u6837\u7684\u8bc4\u4f30\u573a\u666f\uff0c\u76f4\u63a5\u6309\u5e38\u89c4\u65b9\u5f0f\u914d\u7f6e\u5373\u53ef\uff0c\u4fdd\u8bc1\u76f8\u540c\u7684 seed \u8fd4\u56de\u76f8\u540c\u7684\u6570\u636e\u3002\u968f\u673a\u91c7\u6837\u662f\u9ed8\u8ba4\u5b9e\u73b0\uff0c\u65e0\u9700\u7279\u6b8a\u914d\u7f6e\u3002"),(0,l.yg)("h2",{id:"4-\u8f68\u8ff9\u5408\u6210\u904d\u5386\u6570\u636e\u96c6\u914d\u7f6e"},"4. \u8f68\u8ff9\u5408\u6210\u904d\u5386\u6570\u636e\u96c6\u914d\u7f6e"),(0,l.yg)("h3",{id:"41-agenticrolloutpipeline-\u5b9e\u73b0"},"4.1 AgenticRolloutPipeline \u5b9e\u73b0"),(0,l.yg)("p",null,"\u4f4d\u7f6e\uff1a",(0,l.yg)("inlineCode",{parentName:"p"},"roll/pipeline/agentic/agentic_rollout_pipeline.py")),(0,l.yg)("h3",{id:"42-\u542f\u52a8\u65b9\u5f0f"},"4.2 \u542f\u52a8\u65b9\u5f0f"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-shell"},"python examples/start_agentic_rollout_pipeline.py --config_path $CONFIG_PATH --config_name $CONFIG_NAME\n")),(0,l.yg)("h3",{id:"43-\u6838\u5fc3\u914d\u7f6e\u53c2\u8003"},"4.3 \u6838\u5fc3\u914d\u7f6e\u53c2\u8003"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-yaml"},'# \u8f68\u8ff9\u5b58\u50a8\u76ee\u5f55\nrollout_dump_dir: /data/oss_bucket_0/lixing/log/swe/${model_name}/rollout_trajectories\n\n# \u652f\u6301 ODPS \u5b58\u50a8\n# rollout_dump_dir: odps://odps_project/tables/table_name/ds=${model_name}\n\n# \u73af\u5883\u7ba1\u7406\u5668\u914d\u7f6e\ntrain_env_manager:\n  max_env_num_per_worker: 16\n  num_env_groups: 32\n  group_size: 1  # \u652f\u6301\u540c\u4e00\u4e2a prompt rollout \u591a\u6761\u8f68\u8ff9\n  tags: [SWEEnvVal]\n  num_groups_partition: [32]\n\n# \u81ea\u5b9a\u4e49\u73af\u5883\u914d\u7f6e\ncustom_envs:\n  SWEEnvVal:\n    env_type: "swe_env"\n    env_config:\n      mode: val  # \u9a8c\u8bc1\u6a21\u5f0f\n')),(0,l.yg)("h3",{id:"44-\u8f68\u8ff9-dump-\u914d\u7f6e"},"4.4 \u8f68\u8ff9 Dump \u914d\u7f6e"),(0,l.yg)("p",null,"\u5728 EnvManager \u7684 ",(0,l.yg)("inlineCode",{parentName:"p"},"formulate_rollouts")," \u65b9\u6cd5\u4e2d\uff0c\u9700\u8981\u6ce8\u518c\u9700\u8981 dump \u7684\u5b57\u6bb5\u53ca\u7c7b\u578b\uff1a"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-python"},'def formulate_rollouts(self, rollout_cache: RolloutCache):\n    # \u51c6\u5907\u6570\u636e\n    save = {\n        "task_idx": task_idx,\n        "episode_score": episode_score,\n        "traj_messages": traj_messages,\n        "metrics": metrics,\n        # ... \u5176\u4ed6\u5b57\u6bb5\n    }\n    \n    # \u6ce8\u518c dump \u5b57\u6bb5\n    lm_input.non_tensor_batch["model_name"] = np.array(\n        [os.path.basename(self.pipeline_config.base_dir)], dtype=object\n    )\n    lm_input.non_tensor_batch["save_content"] = np.array([json.dumps(save)], dtype=object)\n    lm_input.non_tensor_batch["step"] = np.array([self.current_step], dtype=object)\n    lm_input.non_tensor_batch["task_idx"] = np.array([task_idx], dtype=object)\n    lm_input.non_tensor_batch["stop_reason"] = np.array([stop_reason], dtype=object)\n    lm_input.non_tensor_batch["mode"] = np.array([self.mode], dtype=object)\n    lm_input.non_tensor_batch["episode_score"] = np.array([episode_score], dtype=object)\n    \n    # \u914d\u7f6e\u6570\u636e\u5e93\u5b57\u6bb5\u7c7b\u578b\n    colummns_config = [\n        ["task_idx", "bigint"],\n        ["model_name", "string"],\n        ["stop_reason", "string"],\n        ["episode_score", "double"],\n        ["mode", "string"],\n        ["save_content", "string"],\n    ]\n    lm_input.meta_info["COLUMMNS_CONFIG"] = colummns_config\n    \n    return lm_input\n')),(0,l.yg)("h3",{id:"45-\u91cd\u8981\u8bf4\u660e"},"4.5 \u91cd\u8981\u8bf4\u660e"),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("strong",{parentName:"li"},"columns_config \u4e2d\u7684 key \u5728 dump \u4e4b\u540e\u4f1a\u4ece data_proto \u4e2d\u79fb\u51fa")),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("strong",{parentName:"li"},"save_content \u5b57\u6bb5\u5305\u542b\u5b8c\u6574\u7684\u8f68\u8ff9\u4fe1\u606f\uff0c\u4ee5 JSON \u683c\u5f0f\u5b58\u50a8")),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("strong",{parentName:"li"},"\u652f\u6301\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u548c ODPS \u8868\u5b58\u50a8")),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("strong",{parentName:"li"},"\u6bcf\u4e2a\u8f68\u8ff9\u90fd\u6709\u552f\u4e00\u7684 trajectory_id \u7528\u4e8e\u8ffd\u8e2a"))),(0,l.yg)("h2",{id:"5-\u8f68\u8ff9\u8fc7\u6ee4"},"5. \u8f68\u8ff9\u8fc7\u6ee4"),(0,l.yg)("h3",{id:"51-\u4f7f\u7528\u65b9\u5f0f"},"5.1 \u4f7f\u7528\u65b9\u5f0f"),(0,l.yg)("p",null,"\u8f68\u8ff9\u8fc7\u6ee4\u529f\u80fd\u901a\u8fc7 ",(0,l.yg)("inlineCode",{parentName:"p"},"roll.pipeline.agentic.agentic_config.EnvManagerConfig.group_filter_cls")," \u914d\u7f6e\u8fc7\u6ee4\u51fd\u6570\u5b9e\u73b0\u3002",(0,l.yg)("inlineCode",{parentName:"p"},"roll.pipeline.agentic.agentic_pipeline.GroupFilter")," \u662f\u9ed8\u8ba4\u5b9e\u73b0\u3002"),(0,l.yg)("h3",{id:"52-\u81ea\u5b9a\u4e49\u8fc7\u6ee4\u903b\u8f91"},"5.2 \u81ea\u5b9a\u4e49\u8fc7\u6ee4\u903b\u8f91"),(0,l.yg)("p",null,"\u53ef\u4ee5\u81ea\u5b9a\u4e49\u590d\u6742\u7684\u8f68\u8ff9\u8fc7\u6ee4\u903b\u8f91\uff0c\u4f8b\u5982\uff1a"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-python"},'class GroupFilter:\n    def __init__(self, config: AgenticConfig, env_manager_config: EnvManagerConfig, mode: str):\n        pass\n\n    def filter(self, group_id: int, episode_id: int, group: list[DataProto]):\n        for data in group:\n            if data.meta_info["drop_flag"]:\n                return True\n')),(0,l.yg)("p",null,"\u901a\u8fc7\u81ea\u5b9a\u4e49\u8fc7\u6ee4\u51fd\u6570\uff0c\u53ef\u4ee5\u57fa\u4e8e\u8f68\u8ff9\u7684\u5404\u79cd\u5c5e\u6027\uff08\u5982\u5206\u6570\u3001\u957f\u5ea6\u3001\u505c\u6b62\u539f\u56e0\u7b49\uff09\u5b9e\u73b0\u7075\u6d3b\u7684\u8fc7\u6ee4\u7b56\u7565\u3002"),(0,l.yg)("h2",{id:"6-\u5e38\u89c1\u95ee\u9898"},"6. \u5e38\u89c1\u95ee\u9898"),(0,l.yg)("h3",{id:"q1-\u5982\u4f55\u5904\u7406\u6570\u636e\u96c6\u904d\u5386\u5b8c\u6210\u7684\u60c5\u51b5"},"Q1: \u5982\u4f55\u5904\u7406\u6570\u636e\u96c6\u904d\u5386\u5b8c\u6210\u7684\u60c5\u51b5\uff1f"),(0,l.yg)("p",null,"A: \u5728 ",(0,l.yg)("inlineCode",{parentName:"p"},"reset")," \u65b9\u6cd5\u4e2d\u68c0\u67e5 ",(0,l.yg)("inlineCode",{parentName:"p"},"get_data_item")," \u8fd4\u56de\u503c\uff0c\u5982\u679c\u8fd4\u56de None\uff0c\u8868\u793a\u6570\u636e\u96c6\u904d\u5386\u5b8c\u6210\uff0c\u5e94\u8be5\u8fd4\u56de None \u9000\u51fa\u5faa\u73af\u3002"),(0,l.yg)("h3",{id:"q2-\u5982\u4f55\u786e\u4fdd\u5b9e\u9a8c\u7684\u53ef\u91cd\u73b0\u6027"},"Q2: \u5982\u4f55\u786e\u4fdd\u5b9e\u9a8c\u7684\u53ef\u91cd\u73b0\u6027\uff1f"),(0,l.yg)("p",null,"A: \u901a\u8fc7\u7edf\u4e00\u7684 seed \u7ba1\u7406\u673a\u5236\uff0c\u786e\u4fdd\u76f8\u540c\u7684 seed \u8fd4\u56de\u76f8\u540c\u7684\u6570\u636e\u3002GlobalDataset \u7684 ",(0,l.yg)("inlineCode",{parentName:"p"},"get_data_item")," \u65b9\u6cd5\u4fdd\u8bc1\u4e86\u8fd9\u4e00\u70b9\u3002"),(0,l.yg)("h3",{id:"q3-\u5982\u4f55\u5904\u7406\u5927\u89c4\u6a21\u8f68\u8ff9\u6570\u636e\u7684\u5b58\u50a8"},"Q3: \u5982\u4f55\u5904\u7406\u5927\u89c4\u6a21\u8f68\u8ff9\u6570\u636e\u7684\u5b58\u50a8\uff1f"),(0,l.yg)("p",null,"A: \u53ef\u4ee5\u4f7f\u7528 ODPS \u8868\u5b58\u50a8\uff0c\u901a\u8fc7\u914d\u7f6e ",(0,l.yg)("inlineCode",{parentName:"p"},"rollout_dump_dir")," \u4e3a ",(0,l.yg)("inlineCode",{parentName:"p"},"odps://")," \u683c\u5f0f\u7684 URL \u6765\u5b9e\u73b0\u3002\u4f8b\u5982\uff1a"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-yaml"},"rollout_dump_dir: odps://odps_project/tables/table_name/ds=${model_name}\n")),(0,l.yg)("h3",{id:"q4-\u5982\u4f55\u8c03\u8bd5\u8f68\u8ff9\u751f\u6210\u8fc7\u7a0b"},"Q4: \u5982\u4f55\u8c03\u8bd5\u8f68\u8ff9\u751f\u6210\u8fc7\u7a0b\uff1f"),(0,l.yg)("p",null,"A: \u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u65e5\u5fd7\u7ea7\u522b\u548c\u6dfb\u52a0\u81ea\u5b9a\u4e49\u65e5\u5fd7\u6765\u8c03\u8bd5\u8f68\u8ff9\u751f\u6210\u8fc7\u7a0b\u3002\u8f68\u8ff9\u6570\u636e\u4f1a\u4ee5 JSON \u683c\u5f0f\u5b8c\u6574\u4fdd\u5b58\uff0c\u4fbf\u4e8e\u5206\u6790\u3002"),(0,l.yg)("p",null,"\u591a\u8f6e\u4ea4\u4e92\u672c\u5730\u8c03\u8bd5\u53c2\u8003\u6587\u6863\uff1a",(0,l.yg)("a",{parentName:"p",href:"docs_roll/docs/%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87/%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/debug_guide.md"},"\u8c03\u8bd5\u6307\u5357")))}u.isMDXComponent=!0}}]);