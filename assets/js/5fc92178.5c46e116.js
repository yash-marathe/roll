"use strict";(globalThis.webpackChunkdocs_roll=globalThis.webpackChunkdocs_roll||[]).push([[9952],{28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>t});var r=i(96540);const a={},s=r.createContext(a);function o(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),r.createElement(s.Provider,{value:n},e.children)}},58866:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>g,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"User Guides/Configuration/config_system","title":"ROLL Configuration System Detailed Explanation","description":"The ROLL framework adopts a structured configuration system that defines experimental parameters through YAML files. This document will provide a detailed introduction to ROLL\'s configuration design, helping new users understand the framework\'s configuration structure and extension methods.","source":"@site/docs/User Guides/Configuration/config_system.md","sourceDirName":"User Guides/Configuration","slug":"/User Guides/Configuration/config_system","permalink":"/ROLL/docs/User Guides/Configuration/config_system","draft":false,"unlisted":false,"editUrl":"https://github.com/alibaba/ROLL/tree/main/docs_roll/docs/User Guides/Configuration/config_system.md","tags":[],"version":"current","lastUpdatedAt":1764223793000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Configuration Guide","permalink":"/ROLL/docs/User Guides/Configuration/config_guide"},"next":{"title":"DeepSpeed Training Backend Configuration Guide","permalink":"/ROLL/docs/User Guides/Configuration/deepspeed"}}');var a=i(74848),s=i(28453);const o={},t="ROLL Configuration System Detailed Explanation",l={},c=[{value:"Configuration System Architecture",id:"configuration-system-architecture",level:2},{value:"1. BaseConfig - Base Configuration Class",id:"1-baseconfig---base-configuration-class",level:3},{value:"2. WorkerConfig - Worker Node Configuration Class",id:"2-workerconfig---worker-node-configuration-class",level:3},{value:"3. PipelineConfig - Pipeline Configuration Class",id:"3-pipelineconfig---pipeline-configuration-class",level:3},{value:"4. Strategy - Strategy Configuration",id:"4-strategy---strategy-configuration",level:3},{value:"5. Arguments Classes",id:"5-arguments-classes",level:3},{value:"Configuration Class UML Diagram",id:"configuration-class-uml-diagram",level:2},{value:"Mapping between YAML Configuration and PipelineConfig",id:"mapping-between-yaml-configuration-and-pipelineconfig",level:2},{value:"Configuration Validation Mechanism",id:"configuration-validation-mechanism",level:2},{value:"Global Environment Variables/Worker-Specific Environment Variables Configuration Entry",id:"global-environment-variablesworker-specific-environment-variables-configuration-entry",level:2},{value:"Configuration Method",id:"configuration-method",level:3},{value:"Global Environment Variable Configuration",id:"global-environment-variable-configuration",level:4},{value:"Worker-Specific Environment Variable Configuration",id:"worker-specific-environment-variable-configuration",level:4},{value:"Priority Rules",id:"priority-rules",level:3},{value:"Configuration Example Analysis",id:"configuration-example-analysis",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"roll-configuration-system-detailed-explanation",children:"ROLL Configuration System Detailed Explanation"})}),"\n",(0,a.jsx)(n.p,{children:"The ROLL framework adopts a structured configuration system that defines experimental parameters through YAML files. This document will provide a detailed introduction to ROLL's configuration design, helping new users understand the framework's configuration structure and extension methods."}),"\n",(0,a.jsx)(n.h2,{id:"configuration-system-architecture",children:"Configuration System Architecture"}),"\n",(0,a.jsx)(n.p,{children:"ROLL's configuration system is primarily composed of the following core components:"}),"\n",(0,a.jsx)(n.h3,{id:"1-baseconfig---base-configuration-class",children:"1. BaseConfig - Base Configuration Class"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"BaseConfig"})," is the base class for all configurations, defining basic experimental parameters such as:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Experiment name (",(0,a.jsx)(n.code,{children:"exp_name"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:["Random seed (",(0,a.jsx)(n.code,{children:"seed"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:["Output directory (",(0,a.jsx)(n.code,{children:"output_dir"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:["Log directory (",(0,a.jsx)(n.code,{children:"logging_dir"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:["Tracker configuration (",(0,a.jsx)(n.code,{children:"track_with"}),", ",(0,a.jsx)(n.code,{children:"tracker_kwargs"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:["Training step control (",(0,a.jsx)(n.code,{children:"max_steps"}),", ",(0,a.jsx)(n.code,{children:"save_steps"}),", ",(0,a.jsx)(n.code,{children:"logging_steps"}),", ",(0,a.jsx)(n.code,{children:"eval_steps"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:["Batch size (",(0,a.jsx)(n.code,{children:"rollout_batch_size"}),", ",(0,a.jsx)(n.code,{children:"val_batch_size"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:["Sequence length settings (",(0,a.jsx)(n.code,{children:"prompt_length"}),", ",(0,a.jsx)(n.code,{children:"response_length"}),", ",(0,a.jsx)(n.code,{children:"sequence_length"}),")"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"2-workerconfig---worker-node-configuration-class",children:"2. WorkerConfig - Worker Node Configuration Class"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"WorkerConfig"})," defines the configuration for each worker node (such as training/inference roles), including:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Model parameters (",(0,a.jsx)(n.code,{children:"model_args"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:["Training parameters (",(0,a.jsx)(n.code,{children:"training_args"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:["Data parameters (",(0,a.jsx)(n.code,{children:"data_args"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:["Generation parameters (",(0,a.jsx)(n.code,{children:"generating_args"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:["Strategy parameters (",(0,a.jsx)(n.code,{children:"strategy_args"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:["Device mapping (",(0,a.jsx)(n.code,{children:"device_mapping"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:["Number of worker nodes (",(0,a.jsx)(n.code,{children:"world_size"}),")"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"3-pipelineconfig---pipeline-configuration-class",children:"3. PipelineConfig - Pipeline Configuration Class"}),"\n",(0,a.jsxs)(n.p,{children:["In RLVR scenarios, ",(0,a.jsx)(n.code,{children:"RLVRConfig"})," inherits from ",(0,a.jsx)(n.code,{children:"BaseConfig"})," and serves as the configuration class for specific tasks (other PipelineConfigs include AgenticConfig, DPOConfig, DistillConfig). It includes:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Role configurations (",(0,a.jsx)(n.code,{children:"actor_train"}),", ",(0,a.jsx)(n.code,{children:"actor_infer"}),", ",(0,a.jsx)(n.code,{children:"reference"}),", ",(0,a.jsx)(n.code,{children:"critic"}),", ",(0,a.jsx)(n.code,{children:"rewards"}),", etc.)"]}),"\n",(0,a.jsxs)(n.li,{children:["RL algorithm-related parameters (",(0,a.jsx)(n.code,{children:"ppo_epochs"}),", ",(0,a.jsx)(n.code,{children:"adv_estimator"}),", ",(0,a.jsx)(n.code,{children:"reward_clip"}),", etc.)"]}),"\n",(0,a.jsxs)(n.li,{children:["Data processing parameters (",(0,a.jsx)(n.code,{children:"max_len_mask"}),", ",(0,a.jsx)(n.code,{children:"difficulty_mask"}),", etc.)"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"4-strategy---strategy-configuration",children:"4. Strategy - Strategy Configuration"}),"\n",(0,a.jsx)(n.p,{children:"Strategy configuration defines the training/inference strategy used by each worker node, including:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Strategy name (such as ",(0,a.jsx)(n.code,{children:"megatron_train"}),", ",(0,a.jsx)(n.code,{children:"vllm"}),", ",(0,a.jsx)(n.code,{children:"sglang"}),", ",(0,a.jsx)(n.code,{children:"deepspeed_train"}),", etc.)"]}),"\n",(0,a.jsx)(n.li,{children:"Strategy-specific parameters (such as tensor parallel size, pipeline parallel size, etc.)"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"5-arguments-classes",children:"5. Arguments Classes"}),"\n",(0,a.jsx)(n.p,{children:"ROLL uses multiple argument classes to organize configurations:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"ModelArguments"}),": Model-related parameters"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"TrainingArguments"}),": Training-related parameters"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"GeneratingArguments"}),": Generation-related parameters"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"DataArguments"}),": Data-related parameters"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"configuration-class-uml-diagram",children:"Configuration Class UML Diagram"}),"\n",(0,a.jsx)(n.p,{children:"To better understand ROLL's configuration system, the UML diagram of RLVRConfig is shown below:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"BaseConfig provides the most basic configuration keys, and specific application PipelineConfigs inherit from BaseConfig"}),"\n",(0,a.jsx)(n.li,{children:"In PipelineConfig, multiple WorkerConfigs can be defined according to application needs. WorkerConfigs are independent and can be freely assigned independent resources and training/inference backends"}),"\n",(0,a.jsx)(n.li,{children:"In WorkerConfig, ModelArguments, TrainingArguments, GeneratingArguments, DataArguments, and backend StrategyArguments held by the role are defined as needed"}),"\n",(0,a.jsx)(n.li,{children:"WorkerConfig can be extended as needed to construct new application configurations"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"https://img.alicdn.com/imgextra/i2/O1CN012otRDy1m5AcR0Dcsx_!!6000000004902-2-tps-3034-1742.png",alt:"RLVRConfig Diagram"})}),"\n",(0,a.jsx)(n.h2,{id:"mapping-between-yaml-configuration-and-pipelineconfig",children:"Mapping between YAML Configuration and PipelineConfig"}),"\n",(0,a.jsx)(n.p,{children:"In ROLL, there is a direct mapping relationship between YAML configuration files and Python configuration classes:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Top-level fields in the YAML file correspond to the attributes of ",(0,a.jsx)(n.code,{children:"PipelineConfig"}),"->",(0,a.jsx)(n.code,{children:"BaseConfig"})]}),"\n",(0,a.jsxs)(n.li,{children:["Role configurations (such as ",(0,a.jsx)(n.code,{children:"actor_train"}),", ",(0,a.jsx)(n.code,{children:"actor_infer"}),") correspond to ",(0,a.jsx)(n.code,{children:"WorkerConfig"})," instances, which correspond to the configuration of attribute classes in ",(0,a.jsx)(n.code,{children:"PipelineConfig"})]}),"\n",(0,a.jsxs)(n.li,{children:["Sub-fields under each role (such as ",(0,a.jsx)(n.code,{children:"model_args"}),", ",(0,a.jsx)(n.code,{children:"training_args"}),") correspond to the corresponding parameter class instances"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"For example, in the YAML file:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"actor_train:\n  model_args:\n    disable_gradient_checkpointing: false\n    dtype: bf16\n  training_args:\n    learning_rate: 1.0e-6\n    per_device_train_batch_size: 1\n"})}),"\n",(0,a.jsx)(n.p,{children:"Mapping to Python code:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'config.actor_train.model_args.disable_gradient_checkpointing = False\nconfig.actor_train.model_args.dtype = "bf16"\nconfig.actor_train.training_args.learning_rate = 1.0e-6\nconfig.actor_train.training_args.per_device_train_batch_size = 1\n'})}),"\n",(0,a.jsx)(n.h2,{id:"configuration-validation-mechanism",children:"Configuration Validation Mechanism"}),"\n",(0,a.jsx)(n.p,{children:"ROLL's configuration system has strict validation mechanisms:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Configuration items in YAML must be explicitly defined in the corresponding Config class to be used"}),"\n",(0,a.jsx)(n.li,{children:"Configuration item validation is implemented through data class type annotations and metadata"}),"\n",(0,a.jsxs)(n.li,{children:["Additional logical validation is performed in the ",(0,a.jsx)(n.code,{children:"__post_init__"})," method"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"This design prevents configuration item confusion and ensures configuration consistency and correctness."}),"\n",(0,a.jsx)(n.h2,{id:"global-environment-variablesworker-specific-environment-variables-configuration-entry",children:"Global Environment Variables/Worker-Specific Environment Variables Configuration Entry"}),"\n",(0,a.jsx)(n.p,{children:"In the ROLL framework, environment variable settings are divided into two levels:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Global Environment Variables"}),": Configured on ",(0,a.jsx)(n.code,{children:"pipeline_config"})," with ",(0,a.jsx)(n.code,{children:"system_envs"}),", taking effect for all roles in the entire pipeline."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Worker-Specific Environment Variables"}),": Configured in ",(0,a.jsx)(n.code,{children:"system_envs"})," within ",(0,a.jsx)(n.code,{children:"worker_config"}),", taking effect only when the Worker's Ray Actor is created."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"configuration-method",children:"Configuration Method"}),"\n",(0,a.jsx)(n.h4,{id:"global-environment-variable-configuration",children:"Global Environment Variable Configuration"}),"\n",(0,a.jsxs)(n.p,{children:["Set the ",(0,a.jsx)(n.code,{children:"system_envs"})," field at the top level of the YAML configuration file:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'exp_name: "example-exp"\n# Other basic configurations...\n\n# Global environment variable settings\nsystem_envs:\n  NVTE_TORCH_COMPILE: \'0\'\n  RAY_PROFILING: "1"\n\n# Role configurations\nactor_train:\n  # ...\n'})}),"\n",(0,a.jsx)(n.h4,{id:"worker-specific-environment-variable-configuration",children:"Worker-Specific Environment Variable Configuration"}),"\n",(0,a.jsxs)(n.p,{children:["Set the ",(0,a.jsx)(n.code,{children:"system_envs"})," field in specific role configurations:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"actor_train:\n  model_args:\n    # ...\n  training_args:\n    # ...\n  # Environment variables effective only for actor_train role\n  system_envs:\n    NVTE_TORCH_COMPILE: '0'\n\nactor_infer:\n  model_args:\n    # ...\n  generating_args:\n    # ...\n  # Environment variables effective only for actor_infer role\n  system_envs:\n    NVTE_TORCH_COMPILE: '0'\n"})}),"\n",(0,a.jsx)(n.h3,{id:"priority-rules",children:"Priority Rules"}),"\n",(0,a.jsx)(n.p,{children:"When global environment variables and role-specific environment variables conflict, role-specific environment variables have higher priority and will override global settings."}),"\n",(0,a.jsx)(n.p,{children:"Through this hierarchical environment variable configuration method, the ROLL framework provides independent and flexible environment variable configuration capabilities to meet different Worker requirements."}),"\n",(0,a.jsx)(n.h2,{id:"configuration-example-analysis",children:"Configuration Example Analysis"}),"\n",(0,a.jsxs)(n.p,{children:["The following is a detailed analysis of the ",(0,a.jsx)(n.code,{children:"example_grpo.yaml"})," configuration file:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'# Basic configuration\nexp_name: "qwen2.5-7B-rlvr-config"  # Experiment name\nseed: 42  # Random seed\nlogging_dir: ./output/logs  # Log directory\noutput_dir: ./output  # Output directory\n\n# Checkpoint saving configuration\ncheckpoint_config:\n  type: file_system\n  output_dir: /data/cpfs_0/rl_examples/models/${exp_name}\n\n# Tracker configuration\ntrack_with: tensorboard  # Using tensorboard for tracking\ntracker_kwargs:\n  log_dir: /data/oss_bucket_0/rl_examples/llm/tensorboard/roll_exp/rlvr  # Log directory\n\n# GRPO algorithm-related configuration\nrollout_batch_size: 64  # Rollout batch size\nadv_estimator: "grpo"  # Advantage estimator using GRPO\nnum_return_sequences_in_group: 8  # Number of sequences returned per group\n\n# Sequence length configuration\nprompt_length: 2048  # Prompt length\nresponse_length: 4096  # Response length\n\n# Training parameters\nppo_epochs: 1  # PPO optimization rounds\nuse_kl_loss: true  # Use KL divergence loss\nkl_loss_coef: 0.001  # KL loss coefficient\nloss_agg_mode: "seq-mean-token-sum"  # Loss aggregation mode\n\n# Advantage calculation related\nwhiten_advantages: true  # Whiten advantage values\nadvantage_clip: 2.0  # Advantage value clipping\ndual_clip_loss: true  # Use dual clipping loss\n\n# Reward processing\nreward_clip: 10  # Reward value clipping\n\n# Model configuration\npretrain: Qwen/Qwen2.5-7B  # Pretrained model path\nreward_pretrain: Qwen/Qwen2.5-7B  # Reward model path\n\n# Role configurations\nactor_train:  # Training role\n  model_args:\n    disable_gradient_checkpointing: false  # Enable gradient checkpointing\n    dtype: bf16  # Data type\n  training_args:\n    learning_rate: 1.0e-6  # Learning rate\n    per_device_train_batch_size: 1  # Training batch size per device\n    gradient_accumulation_steps: 32  # Gradient accumulation steps\n  strategy_args:\n    strategy_name: megatron_train  # Using Megatron training strategy\n    strategy_config:\n      tensor_model_parallel_size: 1  # Tensor parallel size\n      pipeline_model_parallel_size: 1  # Pipeline parallel size\n  device_mapping: list(range(0,16))  # Device mapping\n\nactor_infer:  # Inference role\n  model_args:\n    disable_gradient_checkpointing: true  # Disable gradient checkpointing\n    dtype: bf16  # Data type\n  generating_args:\n    max_new_tokens: ${response_length}  # Maximum new tokens\n    temperature: 0.99  # Temperature parameter\n  strategy_args:\n    strategy_name: vllm  # Using vLLM inference strategy\n    strategy_config:\n      gpu_memory_utilization: 0.8  # GPU memory utilization\n  device_mapping: list(range(0,12))  # Device mapping\n\n# Reward model configuration\nrewards:\n  math_rule:  # Math rule reward\n    worker_cls: roll.pipeline.rlvr.rewards.math_rule_reward_worker.MathRuleRewardWorker  # Worker class\n    model_args:\n      model_name_or_path: ${reward_pretrain}  # Model path\n    tag_included: [deepmath_103k, aime]  # Included tags\n    world_size: 8  # Number of worker nodes\n'})}),"\n",(0,a.jsx)(n.p,{children:"Through the above analysis, users can better understand the structure and usage methods of the ROLL configuration system."})]})}function g(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}}}]);