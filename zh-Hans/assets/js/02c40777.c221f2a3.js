"use strict";(globalThis.webpackChunkdocs_roll=globalThis.webpackChunkdocs_roll||[]).push([[8929],{28453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>o});var i=r(96540);const l={},s=i.createContext(l);function t(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),i.createElement(s.Provider,{value:n},e.children)}},82145:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"User Guides/Configuration/fp8_rollout","title":"FP8 \u91cf\u5316\u914d\u7f6e\u6307\u5357","description":"\u672c\u6587\u6863\u4ecb\u7ecd\u5982\u4f55\u5728 ROLL \u4e2d\u4f7f\u7528 FP8 \u91cf\u5316\u6765\u4f18\u5316\u63a8\u7406\u6027\u80fd\u548c\u663e\u5b58\u4f7f\u7528\u3002","source":"@site/i18n/zh-Hans/docusaurus-plugin-content-docs/current/User Guides/Configuration/fp8_rollout.md","sourceDirName":"User Guides/Configuration","slug":"/User Guides/Configuration/fp8_rollout","permalink":"/ROLL/zh-Hans/docs/User Guides/Configuration/fp8_rollout","draft":false,"unlisted":false,"editUrl":"https://github.com/alibaba/ROLL/tree/main/docs_roll/docs/User Guides/Configuration/fp8_rollout.md","tags":[],"version":"current","lastUpdatedAt":1764225914000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"ROLL \u8d44\u6e90\u914d\u7f6e","permalink":"/ROLL/zh-Hans/docs/User Guides/Configuration/device_mapping"},"next":{"title":"LoRA \u5fae\u8c03\u914d\u7f6e\u6307\u5357","permalink":"/ROLL/zh-Hans/docs/User Guides/Configuration/lora"}}');var l=r(74848),s=r(28453);const t={},o="FP8 \u91cf\u5316\u914d\u7f6e\u6307\u5357",c={},a=[{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:2},{value:"actor_infer FP8 \u914d\u7f6e",id:"actor_infer-fp8-\u914d\u7f6e",level:2},{value:"\u57fa\u672c\u914d\u7f6e",id:"\u57fa\u672c\u914d\u7f6e",level:3},{value:"Dense \u6a21\u578b\u914d\u7f6e",id:"dense-\u6a21\u578b\u914d\u7f6e",level:3},{value:"MoE \u6a21\u578b\u914d\u7f6e",id:"moe-\u6a21\u578b\u914d\u7f6e",level:3},{value:"llm_judge FP8 \u914d\u7f6e",id:"llm_judge-fp8-\u914d\u7f6e",level:2},{value:"\u914d\u7f6e\u6ce8\u610f\u4e8b\u9879",id:"\u914d\u7f6e\u6ce8\u610f\u4e8b\u9879",level:2},{value:"\u5b8c\u6574\u793a\u4f8b",id:"\u5b8c\u6574\u793a\u4f8b",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"fp8-\u91cf\u5316\u914d\u7f6e\u6307\u5357",children:"FP8 \u91cf\u5316\u914d\u7f6e\u6307\u5357"})}),"\n",(0,l.jsx)(n.p,{children:"\u672c\u6587\u6863\u4ecb\u7ecd\u5982\u4f55\u5728 ROLL \u4e2d\u4f7f\u7528 FP8 \u91cf\u5316\u6765\u4f18\u5316\u63a8\u7406\u6027\u80fd\u548c\u663e\u5b58\u4f7f\u7528\u3002"}),"\n",(0,l.jsx)(n.h2,{id:"\u6982\u8ff0",children:"\u6982\u8ff0"}),"\n",(0,l.jsx)(n.p,{children:"FP8 \u91cf\u5316\u662f\u4e00\u79cd\u9ad8\u6548\u7684\u6570\u503c\u7cbe\u5ea6\u4f18\u5316\u6280\u672f\uff0c\u53ef\u4ee5\u663e\u8457\u51cf\u5c11\u6a21\u578b\u663e\u5b58\u5360\u7528\u5e76\u63d0\u5347\u63a8\u7406\u901f\u5ea6\u3002ROLL \u652f\u6301 FP8 \u91cf\u5316\u914d\u7f6e\uff0c\u9002\u7528\u4e8e actor_infer \u548c llm_judge \u7ec4\u4ef6\u3002"}),"\n",(0,l.jsx)(n.h2,{id:"actor_infer-fp8-\u914d\u7f6e",children:"actor_infer FP8 \u914d\u7f6e"}),"\n",(0,l.jsx)(n.h3,{id:"\u57fa\u672c\u914d\u7f6e",children:"\u57fa\u672c\u914d\u7f6e"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"actor_infer:\n  strategy_args:\n    strategy_name: vllm\n    strategy_config:\n      quantization: fp8\n"})}),"\n",(0,l.jsx)(n.h3,{id:"dense-\u6a21\u578b\u914d\u7f6e",children:"Dense \u6a21\u578b\u914d\u7f6e"}),"\n",(0,l.jsx)(n.p,{children:"\u5bf9\u4e8e Dense \u6a21\u578b\uff0c\u6839\u636e\u91cf\u5316\u65b9\u5f0f\u4e0d\u540c\uff0c\u914d\u7f6e\u8981\u6c42\u4e5f\u4e0d\u540c\uff1a"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Dense + Per Tensor \u91cf\u5316\uff08\u9ed8\u8ba4\uff09"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"actor_infer:\n  strategy_args:\n    strategy_name: vllm\n    strategy_config:\n      quantization: fp8\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Dense + Per Block \u91cf\u5316"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"actor_infer:\n  strategy_args:\n    strategy_name: vllm\n    strategy_config:\n      quantization: fp8\n      hf_overrides:\n        quantization_config:\n          activation_scheme: dynamic\n          fmt: e4m3\n          quant_method: fp8\n          weight_block_size: [128, 128]  # \u5fc5\u586b\uff1aper block \u91cf\u5316\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u914d\u7f6e\u8bf4\u660e\uff1a"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"activation_scheme: dynamic"}),"\uff1a\u4f7f\u7528\u52a8\u6001\u6fc0\u6d3b\u65b9\u6848"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"fmt: e4m3"}),"\uff1a\u6307\u5b9a FP8 \u683c\u5f0f\u4e3a E4M3"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"quant_method: fp8"}),"\uff1a\u91cf\u5316\u65b9\u6cd5\u8bbe\u7f6e\u4e3a FP8"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"weight_block_size: [128, 128]"}),"\uff1aper block \u91cf\u5316\u65f6\u5fc5\u586b\uff0c\u6307\u5b9a\u6743\u91cd\u5757\u5927\u5c0f"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"\u6ce8\u610f\uff1a"})," \u5f53\u6307\u5b9a ",(0,l.jsx)(n.code,{children:"weight_block_size"})," \u65f6\uff0c\u5fc5\u987b\u540c\u65f6\u586b\u5199 ",(0,l.jsx)(n.code,{children:"activation_scheme"}),"\u3001",(0,l.jsx)(n.code,{children:"fmt"})," \u548c ",(0,l.jsx)(n.code,{children:"quant_method"})," \u4e09\u4e2a\u53c2\u6570\uff0c\u5426\u5219\u4f1a\u62a5\u9519\u3002"]}),"\n",(0,l.jsx)(n.h3,{id:"moe-\u6a21\u578b\u914d\u7f6e",children:"MoE \u6a21\u578b\u914d\u7f6e"}),"\n",(0,l.jsxs)(n.p,{children:["\u5bf9\u4e8e MoE (Mixture of Experts) \u6a21\u578b\uff0c\u5fc5\u987b\u914d\u7f6e ",(0,l.jsx)(n.code,{children:"hf_overrides/quantization_config"}),"\uff0c\u4e14\u53ea\u652f\u6301 per block \u91cf\u5316\uff1a"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"actor_infer:\n  strategy_args:\n    strategy_name: vllm\n    strategy_config:\n      quantization: fp8\n      hf_overrides:\n        quantization_config:\n          activation_scheme: dynamic\n          fmt: e4m3\n          quant_method: fp8\n          weight_block_size: [128, 128]  # \u5fc5\u586b\uff1aMoE \u6a21\u578b\u5fc5\u987b\u4f7f\u7528 per block \u91cf\u5316\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"\u6ce8\u610f\uff1a"})," MoE \u6a21\u578b\u5fc5\u987b\u4f7f\u7528 per block \u91cf\u5316\uff0c",(0,l.jsx)(n.code,{children:"weight_block_size"})," \u53c2\u6570\u5fc5\u586b\uff0c\u540c\u65f6\u5fc5\u987b\u586b\u5199 ",(0,l.jsx)(n.code,{children:"activation_scheme"}),"\u3001",(0,l.jsx)(n.code,{children:"fmt"})," \u548c ",(0,l.jsx)(n.code,{children:"quant_method"})," \u4e09\u4e2a\u53c2\u6570\u3002"]}),"\n",(0,l.jsx)(n.h2,{id:"llm_judge-fp8-\u914d\u7f6e",children:"llm_judge FP8 \u914d\u7f6e"}),"\n",(0,l.jsx)(n.p,{children:"LLM \u4f5c\u4e3a\u8bc4\u5224\u6a21\u578b\u540c\u6837\u652f\u6301 FP8 \u91cf\u5316\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f judge \u6a21\u578b\u9700\u8981\u72ec\u7acb\u7684 GPU \u8d44\u6e90\uff0c\u4e0d\u80fd\u4e0e actor_infer \u5171\u4eab GPU\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"llm_judge:\n  # NOTE: llm as judge \u4e5f\u9700\u8981gpu, \u4e0d\u80fd\u548cactor infer\u5171\u4eabgpu\n  worker_cls: roll.pipeline.rlvr.rewards.llm_judge_reward_worker.LLMJudgeRewardWorker\n  judge_prompt: Qwen2.5-7B-Instruct-RLVR-prompt\n  judge_model_type: inference\n  tag_included: [RLVR]  \n  strategy_args:\n    strategy_name: vllm\n    strategy_config:\n      gpu_memory_utilization: 0.8\n      quantization: fp8\n      max_model_len: 8000\n      load_format: auto\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u914d\u7f6e\u8bf4\u660e\uff1a"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"gpu_memory_utilization: 0.8"}),"\uff1a\u663e\u5b58\u5229\u7528\u7387\u8bbe\u7f6e\u4e3a 80%"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"quantization: fp8"}),"\uff1a\u542f\u7528 FP8 \u91cf\u5316"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"max_model_len: 8000"}),"\uff1a\u6700\u5927\u6a21\u578b\u957f\u5ea6\u9650\u5236"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"load_format: auto"}),"\uff1a\u81ea\u52a8\u9009\u62e9\u52a0\u8f7d\u683c\u5f0f"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u914d\u7f6e\u6ce8\u610f\u4e8b\u9879",children:"\u914d\u7f6e\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"GPU \u8d44\u6e90\u9694\u79bb"}),"\uff1allm_judge \u9700\u8981\u72ec\u7acb\u7684 GPU\uff0c\u4e0d\u80fd\u4e0e actor_infer \u5171\u4eab"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"MoE \u6a21\u578b\u9650\u5236"}),"\uff1aMoE \u6a21\u578b\u5fc5\u987b\u4f7f\u7528 per block \u91cf\u5316\uff0c\u4e0d\u652f\u6301 per tensor \u91cf\u5316"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u5185\u5b58\u4f18\u5316"}),"\uff1aFP8 \u91cf\u5316\u53ef\u4ee5\u663e\u8457\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\uff0c\u5efa\u8bae\u5728\u663e\u5b58\u53d7\u9650\u7684\u573a\u666f\u4e2d\u4f7f\u7528"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u6027\u80fd\u6743\u8861"}),"\uff1a\u867d\u7136 FP8 \u91cf\u5316\u63d0\u5347\u4e86\u6027\u80fd\uff0c\u4f46\u53ef\u80fd\u4f1a\u8f7b\u5fae\u5f71\u54cd\u6a21\u578b\u7cbe\u5ea6\uff0c\u9700\u8981\u6839\u636e\u5177\u4f53\u573a\u666f\u6743\u8861"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u5b8c\u6574\u793a\u4f8b",children:"\u5b8c\u6574\u793a\u4f8b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"# \u914d\u7f6e\u793a\u4f8b\uff1a\u5305\u542b actor_infer \u548c llm_judge \u7684 FP8 \u91cf\u5316\nactor_infer:\n  strategy_args:\n    strategy_name: vllm\n    strategy_config:\n      quantization: fp8\n      hf_overrides:\n        quantization_config:\n          activation_scheme: dynamic\n          fmt: e4m3\n          quant_method: fp8\n          weight_block_size: [128, 128]\n\nllm_judge:\n  worker_cls: roll.pipeline.rlvr.rewards.llm_judge_reward_worker.LLMJudgeRewardWorker\n  judge_prompt: Qwen2.5-7B-Instruct-RLVR-prompt\n  judge_model_type: inference\n  tag_included: [RLVR]  \n  strategy_args:\n    strategy_name: vllm\n    strategy_config:\n      gpu_memory_utilization: 0.8\n      quantization: fp8\n      max_model_len: 8000\n      load_format: auto\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u901a\u8fc7\u4ee5\u4e0a\u914d\u7f6e\uff0c\u60a8\u53ef\u4ee5\u5728 ROLL \u4e2d\u6210\u529f\u542f\u7528 FP8 \u91cf\u5316\uff0c\u83b7\u5f97\u66f4\u597d\u7684\u63a8\u7406\u6027\u80fd\u548c\u663e\u5b58\u6548\u7387\u3002"})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}}}]);