"use strict";(globalThis.webpackChunkdocs_roll=globalThis.webpackChunkdocs_roll||[]).push([[9102],{13018(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>d,metadata:()=>l,toc:()=>o});const l=JSON.parse('{"id":"Development/Developer Guide/llm_as_judge_optimization","title":"LLM as Judge \u5728 Agentic \u73af\u5883\u4e2d\u7684\u4f18\u5316\u5b9e\u73b0","description":"\u672c\u6587\u6863\u4ecb\u7ecd ROLL \u6846\u67b6\u4e2d LLM as Judge \u5728 Agentic \u73af\u5883\u4e2d\u7684\u4f18\u5316\u5b9e\u73b0\u65b9\u6848\uff0c\u5305\u62ec\u7cfb\u7edf\u67b6\u6784\u3001\u8c03\u7528\u94fe\u8def\u3001\u914d\u7f6e\u65b9\u6cd5\u548c\u6700\u4f73\u5b9e\u8df5\u3002","source":"@site/i18n/zh-Hans/docusaurus-plugin-content-docs/current/Development/Developer Guide/llm_as_judge_optimization.md","sourceDirName":"Development/Developer Guide","slug":"/Development/Developer Guide/llm_as_judge_optimization","permalink":"/ROLL/zh-Hans/docs/Development/Developer Guide/llm_as_judge_optimization","draft":false,"unlisted":false,"editUrl":"https://github.com/alibaba/ROLL/tree/main/docs_roll/docs/Development/Developer Guide/llm_as_judge_optimization.md","tags":[],"version":"current","lastUpdatedAt":1770642330000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u81ea\u5b9a\u4e49Env","permalink":"/ROLL/zh-Hans/docs/Development/Developer Guide/customer_env"},"next":{"title":"Prompt\u751f\u6210\u6307\u5357","permalink":"/ROLL/zh-Hans/docs/Development/Developer Guide/prompt_intro"}}');var i=r(74848),s=r(28453);const d={},a="LLM as Judge \u5728 Agentic \u73af\u5883\u4e2d\u7684\u4f18\u5316\u5b9e\u73b0",c={},o=[{value:"\u6982\u89c8",id:"\u6982\u89c8",level:2},{value:"\u6838\u5fc3\u4f18\u52bf",id:"\u6838\u5fc3\u4f18\u52bf",level:3},{value:"\u5e94\u7528\u573a\u666f",id:"\u5e94\u7528\u573a\u666f",level:3},{value:"\u7cfb\u7edf\u67b6\u6784",id:"\u7cfb\u7edf\u67b6\u6784",level:2},{value:"\u6574\u4f53\u67b6\u6784",id:"\u6574\u4f53\u67b6\u6784",level:3},{value:"\u5173\u952e\u7ec4\u4ef6",id:"\u5173\u952e\u7ec4\u4ef6",level:3},{value:"1. Reward Cluster",id:"1-reward-cluster",level:4},{value:"2. Reward Scheduler (Ray Named Actor)",id:"2-reward-scheduler-ray-named-actor",level:4},{value:"3. Reward Proxy",id:"3-reward-proxy",level:4},{value:"4. \u7edf\u4e00\u5de5\u5177\u51fd\u6570 <code>generate_by_proxy</code>",id:"4-\u7edf\u4e00\u5de5\u5177\u51fd\u6570-generate_by_proxy",level:4},{value:"\u8c03\u7528\u94fe\u8def",id:"\u8c03\u7528\u94fe\u8def",level:2},{value:"\u5b8c\u6574\u8c03\u7528\u6d41\u7a0b",id:"\u5b8c\u6574\u8c03\u7528\u6d41\u7a0b",level:3},{value:"\u914d\u7f6e\u8bf4\u660e",id:"\u914d\u7f6e\u8bf4\u660e",level:2},{value:"\u5b8c\u6574\u914d\u7f6e\u793a\u4f8b",id:"\u5b8c\u6574\u914d\u7f6e\u793a\u4f8b",level:3},{value:"\u914d\u7f6e\u5173\u952e\u70b9",id:"\u914d\u7f6e\u5173\u952e\u70b9",level:3},{value:"1. device_mapping\uff08\u5fc5\u987b\u914d\u7f6e\uff09",id:"1-device_mapping\u5fc5\u987b\u914d\u7f6e",level:4},{value:"2. strategy_name\uff08\u63a8\u7406\u540e\u7aef\u9009\u62e9\uff09",id:"2-strategy_name\u63a8\u7406\u540e\u7aef\u9009\u62e9",level:4},{value:"3. generating_args\uff08\u751f\u6210\u53c2\u6570\uff09",id:"3-generating_args\u751f\u6210\u53c2\u6570",level:4},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function t(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"llm-as-judge-\u5728-agentic-\u73af\u5883\u4e2d\u7684\u4f18\u5316\u5b9e\u73b0",children:"LLM as Judge \u5728 Agentic \u73af\u5883\u4e2d\u7684\u4f18\u5316\u5b9e\u73b0"})}),"\n",(0,i.jsx)(n.p,{children:"\u672c\u6587\u6863\u4ecb\u7ecd ROLL \u6846\u67b6\u4e2d LLM as Judge \u5728 Agentic \u73af\u5883\u4e2d\u7684\u4f18\u5316\u5b9e\u73b0\u65b9\u6848\uff0c\u5305\u62ec\u7cfb\u7edf\u67b6\u6784\u3001\u8c03\u7528\u94fe\u8def\u3001\u914d\u7f6e\u65b9\u6cd5\u548c\u6700\u4f73\u5b9e\u8df5\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u6982\u89c8",children:"\u6982\u89c8"}),"\n",(0,i.jsx)(n.p,{children:"LLM as Judge \u662f\u4e00\u79cd\u4f7f\u7528\u5927\u8bed\u8a00\u6a21\u578b\u4f5c\u4e3a\u8bc4\u5224\u5668\u6765\u8bc4\u4f30\u667a\u80fd\u4f53\u54cd\u5e94\u8d28\u91cf\u7684\u65b9\u6cd5\u3002\u5728 Agentic \u8bad\u7ec3\u573a\u666f\u4e2d\uff0c\u5927\u89c4\u6a21\u73af\u5883\u5b9e\u4f8b\u5e76\u53d1\u6267\u884c rollout \u65f6\uff0c\u4f7f\u7528 LLM as Judge \u8ba1\u7b97 reward \u4f1a\u4ea7\u751f\u5927\u91cf\u5e76\u53d1 LLM \u8bf7\u6c42\uff0c\u8fd9\u5bf9\u5916\u90e8 LLM \u670d\u52a1\u7684\u7a33\u5b9a\u6027\u548c\u541e\u5410\u91cf\u63d0\u51fa\u4e86\u5de8\u5927\u6311\u6218\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u4e3a\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\uff0cROLL \u6846\u67b6\u901a\u8fc7",(0,i.jsx)(n.strong,{children:"\u72ec\u7acb\u7684 Reward Cluster"})," \u548c",(0,i.jsx)(n.strong,{children:"\u9ad8\u6548\u7684\u8c03\u5ea6\u673a\u5236"}),"\uff0c\u5b9e\u73b0\u4e86\u53ef\u6269\u5c55\u7684\u672c\u5730\u5316\u5e76\u884c\u8bc4\u4f30\u7cfb\u7edf\uff0c\u907f\u514d\u4e86\u5bf9\u5916\u90e8\u670d\u52a1\u7684\u4f9d\u8d56\uff0c\u786e\u4fdd\u4e86\u8bad\u7ec3\u8fc7\u7a0b\u7684\u7a33\u5b9a\u6027\u548c\u53ef\u63a7\u6027\u3002"]}),"\n",(0,i.jsx)(n.admonition,{title:"\u6587\u6863\u8bf4\u660e",type:"info",children:(0,i.jsxs)(n.p,{children:["\u672c\u6587\u6863\u4ee5 ",(0,i.jsx)(n.strong,{children:"DeepEyes \u73af\u5883"}),"\u7684 LLM as Judge \u5b9e\u73b0\u4e3a\u4f8b\u8fdb\u884c\u8bf4\u660e\u3002\u5bf9\u4e8e\u5176\u4ed6\u9700\u8981\u4f7f\u7528 LLM as Judge \u7684\u73af\u5883\uff0c\u53ef\u4ee5\u53c2\u8003 ",(0,i.jsx)(n.code,{children:"env_manager"})," \u548c ",(0,i.jsx)(n.code,{children:"env"})," \u5185\u7684\u8c03\u7528\u65b9\u5f0f\u81ea\u5b9a\u4e49\u5b9e\u73b0\u3002"]})}),"\n",(0,i.jsx)(n.h3,{id:"\u6838\u5fc3\u4f18\u52bf",children:"\u6838\u5fc3\u4f18\u52bf"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u72ec\u7acb\u8d44\u6e90\u7ba1\u7406"}),"\uff1aReward \u6a21\u578b\u4e0e Policy \u6a21\u578b\u5206\u79bb\uff0c\u53ef\u72ec\u7acb\u5206\u914d GPU \u8d44\u6e90\uff0c\u907f\u514d\u8d44\u6e90\u7ade\u4e89"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u672c\u5730\u5316\u90e8\u7f72"}),"\uff1a\u901a\u8fc7\u672c\u5730 Reward Cluster \u907f\u514d\u5916\u90e8 API \u4f9d\u8d56\uff0c\u4fdd\u8bc1\u670d\u52a1\u7a33\u5b9a\u6027\u548c\u6570\u636e\u5b89\u5168"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u9ad8\u5e76\u53d1\u652f\u6301"}),"\uff1a\u901a\u8fc7 RequestScheduler \u5b9e\u73b0\u591a\u73af\u5883\u5e76\u884c\u7684\u9ad8\u6548 reward \u8bc4\u4f30\uff0c\u652f\u6301\u73af\u5883\u5e76\u53d1\u6269\u5c55"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u7edf\u4e00\u63a5\u53e3\u8bbe\u8ba1"}),"\uff1a\u63d0\u4f9b ",(0,i.jsx)(n.code,{children:"generate_by_proxy"})," \u7edf\u4e00\u5de5\u5177\u51fd\u6570\uff0c\u7b80\u5316 LLM \u8c03\u7528\u903b\u8f91\uff0c\u652f\u6301\u6587\u672c\u548c\u591a\u6a21\u6001"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u7075\u6d3b\u914d\u7f6e"}),"\uff1a\u652f\u6301\u591a\u79cd\u63a8\u7406\u540e\u7aef\uff08vLLM\u3001SGLang\uff09\u548c\u81ea\u5b9a\u4e49\u751f\u6210\u53c2\u6570"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u5e94\u7528\u573a\u666f",children:"\u5e94\u7528\u573a\u666f"}),"\n",(0,i.jsx)(n.p,{children:"\u5178\u578b\u7684 Agentic \u8bad\u7ec3\u573a\u666f\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u73af\u5883\u89c4\u6a21"}),"\uff1a256\u4e2a\u73af\u5883\u7ec4\uff0c\u6bcf\u7ec4 4 \u4e2a\u73af\u5883\uff0c\u5171 1024\u4e2a\u5e76\u53d1\u73af\u5883\u5b9e\u4f8b"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Rollout \u9891\u7387"}),"\uff1a\u6bcf\u4e2a\u73af\u5883\u5b8c\u6210 episode \u540e\u8c03\u7528 LLM Judge"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u5e76\u53d1\u538b\u529b"}),"\uff1a\u5728 rollout \u9ad8\u5cf0\u671f\u53ef\u80fd\u6709 500+ \u4e2a\u73af\u5883\u540c\u65f6\u8bf7\u6c42 reward \u8bc4\u4f30"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u7a33\u5b9a\u6027\u8981\u6c42"}),"\uff1a\u8bad\u7ec3\u8fc7\u7a0b\u4e0d\u80fd\u56e0\u4e3a\u5916\u90e8 API \u9650\u6d41\u6216\u8d85\u65f6\u800c\u4e2d\u65ad"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u901a\u8fc7\u672c\u6587\u6863\u4ecb\u7ecd\u7684\u4f18\u5316\u5b9e\u73b0\uff0c\u53ef\u4ee5\u6709\u6548\u5e94\u5bf9\u4e0a\u8ff0\u6311\u6218\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u7cfb\u7edf\u67b6\u6784",children:"\u7cfb\u7edf\u67b6\u6784"}),"\n",(0,i.jsx)(n.h3,{id:"\u6574\u4f53\u67b6\u6784",children:"\u6574\u4f53\u67b6\u6784"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"AgenticPipeline\n    \u251c\u2500\u2500 Reward Cluster (\u53ef\u9009\uff0c\u72ec\u7acbGPU\u8d44\u6e90)\n    \u2502   \u251c\u2500\u2500 InferWorker (\u9ed8\u8ba4)\n    \u2502   \u2514\u2500\u2500 \u652f\u6301 vLLM/SGLang \u540e\u7aef\n    \u2502\n    \u251c\u2500\u2500 Reward Scheduler (Ray Named Actor)\n    \u2502   \u251c\u2500\u2500 \u8bf7\u6c42\u8def\u7531\u4e0e\u8d1f\u8f7d\u5747\u8861\n    \u2502   \u251c\u2500\u2500 \u5e76\u53d1\u63a7\u5236\n    \u2502   \u2514\u2500\u2500 \u8bf7\u6c42\u8ffd\u8e2a\u4e0e\u6e05\u7406\n    \u2502\n    \u2514\u2500\u2500 Environment Manager\n        \u251c\u2500\u2500 llm_proxy: \u7528\u4e8e policy \u63a8\u7406\n        \u251c\u2500\u2500 reward_proxy: \u7528\u4e8e LLM as Judge\n        \u2514\u2500\u2500 env\u5b9e\u4f8b\n            \u2514\u2500\u2500 \u5728 obtain_outcome_reward \u4e2d\u8c03\u7528 reward_proxy\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u5173\u952e\u7ec4\u4ef6",children:"\u5173\u952e\u7ec4\u4ef6"}),"\n",(0,i.jsx)(n.h4,{id:"1-reward-cluster",children:"1. Reward Cluster"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u4f4d\u7f6e"}),": ",(0,i.jsx)(n.code,{children:"roll/pipeline/agentic/agentic_pipeline.py:88-98"})]}),"\n",(0,i.jsxs)(n.p,{children:["Reward Cluster \u662f\u53ef\u9009\u7ec4\u4ef6\uff0c\u4ec5\u5728\u914d\u7f6e\u4e86 ",(0,i.jsx)(n.code,{children:"device_mapping"})," \u65f6\u521b\u5efa\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"self.reward = None\nif (self.pipeline_config.reward is not None and\n    len(self.pipeline_config.reward.device_mapping) > 0):\n    self.reward = Cluster(\n        name=self.pipeline_config.reward.name,\n        worker_cls=self.pipeline_config.reward.worker_cls,  # \u9ed8\u8ba4 InferWorker\n        resource_manager=self.resource_manager,\n        worker_config=self.pipeline_config.reward,\n    )\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Worker Class \u9ed8\u8ba4\u914d\u7f6e"}),": ",(0,i.jsx)(n.code,{children:"roll/pipeline/agentic/agentic_config.py:287"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u9ed8\u8ba4\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"InferWorker"})," \u4f5c\u4e3a\u63a8\u7406\u5f15\u64ce\uff0c\u590d\u7528ActorInfer Worker\u5b9e\u73b0"]}),"\n",(0,i.jsx)(n.li,{children:"\u652f\u6301 vLLM\u3001SGLang\u7b49\u591a\u79cd\u540e\u7aef"}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"2-reward-scheduler-ray-named-actor",children:"2. Reward Scheduler (Ray Named Actor)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u4f4d\u7f6e"}),": ",(0,i.jsx)(n.code,{children:"roll/pipeline/agentic/agentic_pipeline.py:112-125"})]}),"\n",(0,i.jsx)(n.p,{children:"Reward Scheduler \u4f5c\u4e3a Ray Named Actor \u521b\u5efa\uff0c\u4f9b\u6240\u6709\u73af\u5883\u7ba1\u7406\u5668\u5171\u4eab\u8bbf\u95ee\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'self.reward_scheduler = RequestScheduler.options(\n    name=f"RewardScheduler-{self.pipeline_config.reward.name}",\n    get_if_exists=True,\n    namespace=RAY_NAMESPACE,\n    scheduling_strategy=NodeAffinitySchedulingStrategy(...)\n).remote(\n    infer_cluster=self.reward,\n    pipeline_config=self.pipeline_config,\n    resource_manager=self.resource_manager,\n)\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u6838\u5fc3\u529f\u80fd"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u667a\u80fd\u8def\u7531"}),": \u4f7f\u7528\u6700\u5c11\u8d1f\u8f7d\u8def\u7531\u7b97\u6cd5\u5206\u914d\u8bf7\u6c42\u5230\u4e0d\u540c\u7684 DP rank"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u7c98\u6027\u8def\u7531"}),": \u540c\u4e00\u73af\u5883\u7684\u8bf7\u6c42\u56fa\u5b9a\u8def\u7531\u5230\u540c\u4e00 worker\uff08\u5229\u4e8e KV cache\uff09"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u8bf7\u6c42\u8ffd\u8e2a"}),": \u7ef4\u62a4 ",(0,i.jsx)(n.code,{children:"request_id"})," \u5230 worker \u7684\u6620\u5c04\u5173\u7cfb"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"3-reward-proxy",children:"3. Reward Proxy"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u4f4d\u7f6e"}),": ",(0,i.jsx)(n.code,{children:"roll/pipeline/agentic/env_manager/vl_traj_env_manager.py:85-109"})]}),"\n",(0,i.jsx)(n.p,{children:"\u73af\u5883\u7ba1\u7406\u5668\u901a\u8fc7 Ray \u83b7\u53d6 Reward Scheduler \u5e76\u521b\u5efa Reward Proxy\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# \u4ece Ray \u83b7\u53d6 reward scheduler (Named Actor)\nif self.pipeline_config.reward:\n    self.reward_scheduler = ray.get_actor(\n        name=f"RewardScheduler-{pipeline_config.reward.name}",\n        namespace=RAY_NAMESPACE\n    )\n\n    # \u521b\u5efa reward proxy\n    self.reward_proxy = create_llm_proxy(\n        generate_scheduler=self.reward_scheduler,\n        llm_proxy_config=pipeline_config.reward.llm_proxy,\n        tokenizer=self.reward_tokenizer,\n        env=None,\n    )\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Proxy \u5de5\u5382\u51fd\u6570"}),": ",(0,i.jsx)(n.code,{children:"roll/pipeline/agentic/llm_proxy/__init__.py:11"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u652f\u6301\u591a\u79cd proxy \u7c7b\u578b\uff1a",(0,i.jsx)(n.code,{children:"policy"}),"\u3001",(0,i.jsx)(n.code,{children:"openai"}),"\u3001",(0,i.jsx)(n.code,{children:"random"})]}),"\n",(0,i.jsx)(n.li,{children:"\u901a\u8fc7\u6ce8\u518c\u673a\u5236\u5b9e\u73b0\u53ef\u6269\u5c55\u6027"}),"\n",(0,i.jsx)(n.li,{children:"\u8bad\u7ec3\u9a8c\u8bc1\u8fc7policy\u8bbe\u7f6e\u529f\u80fd\u6b63\u5e38\uff0c\u57fa\u4e8e\u5916\u90e8\u90e8\u7f72\u7684\u5927\u6a21\u578b\u670d\u52a1\u53ef\u4f7f\u7528openai proxy\uff0c\u6ce8\u610f\u5bf9\u5e76\u53d1\u7684\u6311\u6218"}),"\n"]}),"\n",(0,i.jsxs)(n.h4,{id:"4-\u7edf\u4e00\u5de5\u5177\u51fd\u6570-generate_by_proxy",children:["4. \u7edf\u4e00\u5de5\u5177\u51fd\u6570 ",(0,i.jsx)(n.code,{children:"generate_by_proxy"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u4f4d\u7f6e"}),": ",(0,i.jsx)(n.code,{children:"roll/pipeline/agentic/llm_proxy/proxy_utils.py:18-170"})]}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u662fenv\u8c03\u7528\u7684\u6838\u5fc3\u7ec4\u4ef6\uff0c\u63d0\u4f9b\u7edf\u4e00\u7684 LLM \u8c03\u7528\u63a5\u53e3\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def generate_by_proxy(\n    messages: List[Dict[str, Any]],\n    tokenizer: PreTrainedTokenizer,\n    proxy: BaseLLMProxy,\n    enable_thinking: bool = False,\n    generation_config: Optional[Dict[str, Any]] = None,\n    collator: Optional[Any] = None,\n    mm_data: Optional[Dict[str, Any]] = None,\n    src_rank: Optional[int] = None,\n) -> Optional[str]\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u6838\u5fc3\u7279\u6027"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u7edf\u4e00\u63a5\u53e3"}),": \u65e0\u8bba\u6587\u672c\u8fd8\u662f\u591a\u6a21\u6001\uff0c\u90fd\u4f7f\u7528\u76f8\u540c\u7684\u8c03\u7528\u65b9\u5f0f"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u81ea\u52a8\u683c\u5f0f\u5316"}),": \u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"tokenizer.apply_chat_template"})," \u683c\u5f0f\u5316\u6d88\u606f"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u591a\u6a21\u6001\u652f\u6301"}),": \u901a\u8fc7 ",(0,i.jsx)(n.code,{children:"collator"})," \u53c2\u6570\u652f\u6301\u56fe\u50cf/\u89c6\u9891\u8f93\u5165"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"thinking \u673a\u5236"}),": \u652f\u6301 DeepSeek\u3001Qwen \u7b49\u6a21\u578b\u7684\u601d\u8003\u94fe"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u8def\u7531\u63a7\u5236"}),": \u901a\u8fc7 ",(0,i.jsx)(n.code,{children:"src_rank"})," \u53c2\u6570\u5b9e\u73b0\u7c98\u6027\u8def\u7531"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u9519\u8bef\u5904\u7406"}),": \u8fd4\u56de ",(0,i.jsx)(n.code,{children:"None"})," \u8868\u793a\u63a8\u7406\u5931\u8d25\uff0c\u7531\u8c03\u7528\u65b9\u5904\u7406"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u8c03\u7528\u94fe\u8def",children:"\u8c03\u7528\u94fe\u8def"}),"\n",(0,i.jsx)(n.h3,{id:"\u5b8c\u6574\u8c03\u7528\u6d41\u7a0b",children:"\u5b8c\u6574\u8c03\u7528\u6d41\u7a0b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"1. DeepEyesEnv.step() (env/deepeyes/env.py:182-197)\n   \u5f53 done=True \u65f6\u89e6\u53d1 obtain_outcome_reward\n   \u2193\n2. DeepEyesEnv.obtain_outcome_reward() (env/deepeyes/env.py:199-254)\n   \u6784\u5efa judge prompt\uff0c\u8c03\u7528 reward model\n   \u2193\n3. generate_by_proxy() (llm_proxy/proxy_utils.py:18)\n   \u7edf\u4e00\u7684 LLM \u8c03\u7528\u5de5\u5177\u51fd\u6570\n   \u2193\n4. reward_proxy.generate() (llm_proxy/policy_proxy.py:15)\n   \u901a\u8fc7 Ray \u8c03\u7528 scheduler\n   \u2193\n5. reward_scheduler.generate_one_request() (scheduler/generate_scheduler.py:1296)\n   \u8bf7\u6c42\u8def\u7531\u4e0e\u8d1f\u8f7d\u5747\u8861\n   \u2193\n6. infer_cluster.workers[dp_rank].generate_request()\n   \u5b9e\u9645\u7684\u6a21\u578b\u63a8\u7406\n   \u2193\n7. \u8fd4\u56de LLM \u5224\u65ad\u7ed3\u679c\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u914d\u7f6e\u8bf4\u660e",children:"\u914d\u7f6e\u8bf4\u660e"}),"\n",(0,i.jsx)(n.h3,{id:"\u5b8c\u6574\u914d\u7f6e\u793a\u4f8b",children:"\u5b8c\u6574\u914d\u7f6e\u793a\u4f8b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'# Reward \u914d\u7f6e (LLM as Judge for AgenticPipeline)\nreward:\n  name: "reward"\n  worker_cls: "roll.pipeline.base_worker.InferWorker"  # \u9ed8\u8ba4\u503c\uff0c\u53ef\u7701\u7565\n  model_args:\n    model_name_or_path: Qwen/Qwen2.5-72B-Instruct\n    dtype: bf16\n  generating_args:\n    max_new_tokens: 2048\n    temperature: 0.2      # \u8f83\u4f4e\u6e29\u5ea6\u63d0\u9ad8\u5224\u65ad\u7a33\u5b9a\u6027\n    top_p: 0.95\n    top_k: 20\n  strategy_args:\n    strategy_name: vllm   # \u6216 sglang\n    strategy_config:\n      gpu_memory_utilization: 0.8\n      tensor_parallel_size: 4\n      load_format: auto\n  # \u5173\u952e\uff1a\u5fc5\u987b\u975e\u7a7a\u624d\u4f1a\u521b\u5efa reward cluster\n  device_mapping: list(range(8, 16))  # GPUs 8-15\n  llm_proxy:\n    proxy_type: policy  # \u4f7f\u7528 policy proxy\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u914d\u7f6e\u5173\u952e\u70b9",children:"\u914d\u7f6e\u5173\u952e\u70b9"}),"\n",(0,i.jsx)(n.h4,{id:"1-device_mapping\u5fc5\u987b\u914d\u7f6e",children:"1. device_mapping\uff08\u5fc5\u987b\u914d\u7f6e\uff09"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# \u63a8\u8350\u914d\u7f6e\uff1aPolicy \u548c Reward \u4f7f\u7528\u72ec\u7acb GPU\nactor_infer:\n  device_mapping: list(range(0, 8))   # GPUs 0-7\n\nreward:\n  device_mapping: list(range(8, 16))  # GPUs 8-15\uff0c\u72ec\u7acb\u8d44\u6e90\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u7a7a\u6216 None"}),": \u4e0d\u521b\u5efa reward cluster\uff0c\u73af\u5883\u65e0\u6cd5\u4f7f\u7528 LLM as Judge"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u975e\u7a7a"}),": \u521b\u5efa\u72ec\u7acb\u7684 reward cluster\uff0c\u652f\u6301 LLM as Judge"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u72ec\u7acb\u90e8\u7f72"}),": \u4e0e actor_infer \u4f7f\u7528\u4e0d\u540c\u7684 GPU \u8d44\u6e90\uff0cPolicy \u63a8\u7406\u548c Reward \u8bc4\u4f30\u5e76\u884c\u6267\u884c\uff0cactor_infer\u4e0ereward\u5fc5\u987b\u5f97\u72ec\u7acb\u90e8\u7f72"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"2-strategy_name\u63a8\u7406\u540e\u7aef\u9009\u62e9",children:"2. strategy_name\uff08\u63a8\u7406\u540e\u7aef\u9009\u62e9\uff09"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"strategy_args:\n  strategy_name: vllm   # \u6216 sglang\n  strategy_config:\n    gpu_memory_utilization: 0.8\n    tensor_parallel_size: 4\n    load_format: auto\t# \u5fc5\u987b\u914d\u7f6eauto, vllm/sglang strategy\u91cc\u9ed8\u8ba4\u4f7f\u7528dummy load\uff0c\u4f1a\u968f\u673a\u521d\u59cb\u5316\u53c2\u6570\n"})}),"\n",(0,i.jsx)(n.h4,{id:"3-generating_args\u751f\u6210\u53c2\u6570",children:"3. generating_args\uff08\u751f\u6210\u53c2\u6570\uff09"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"generating_args:\n  max_new_tokens: 2048    # \u6839\u636e judge \u8f93\u51fa\u957f\u5ea6\u8c03\u6574\n  temperature: 0.2        # \u8f83\u4f4e\u6e29\u5ea6\u63d0\u9ad8\u7a33\u5b9a\u6027\n  top_p: 0.95\n  top_k: 20\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,i.jsx)(n.p,{children:"LLM as Judge \u5728 Agentic \u73af\u5883\u4e2d\u7684\u4f18\u5316\u5b9e\u73b0\u901a\u8fc7\u4ee5\u4e0b\u5173\u952e\u8bbe\u8ba1\u5b9e\u73b0\u9ad8\u6548\u53ef\u6269\u5c55\uff1a"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u72ec\u7acb Reward Cluster"}),": \u8d44\u6e90\u9694\u79bb\uff0c\u907f\u514d\u4e0e Policy \u63a8\u7406\u7ade\u4e89"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Ray Named Actor"}),": Reward Scheduler \u4f5c\u4e3a\u5171\u4eab\u670d\u52a1\uff0c\u4f9b\u6240\u6709\u73af\u5883\u8bbf\u95ee"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u7edf\u4e00\u5de5\u5177\u51fd\u6570"}),": ",(0,i.jsx)(n.code,{children:"generate_by_proxy"})," \u7b80\u5316\u8c03\u7528\uff0c\u652f\u6301\u6587\u672c\u548c\u591a\u6a21\u6001"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u667a\u80fd\u8def\u7531"}),": \u7c98\u6027\u8def\u7531\u548c\u8d1f\u8f7d\u5747\u8861\uff0c\u63d0\u9ad8\u7f13\u5b58\u5229\u7528\u7387"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u901a\u8fc7\u5408\u7406\u914d\u7f6e\u548c\u4f7f\u7528\u8fd9\u4e9b\u7ec4\u4ef6\uff0c\u53ef\u4ee5\u6784\u5efa\u9ad8\u6548\u3001\u53ef\u9760\u7684 LLM as Judge \u8bc4\u4f30\u7cfb\u7edf\u3002"})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}},28453(e,n,r){r.d(n,{R:()=>d,x:()=>a});var l=r(96540);const i={},s=l.createContext(i);function d(e){const n=l.useContext(s);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),l.createElement(s.Provider,{value:n},e.children)}}}]);